# ğŸš€ åç«¯éƒ¨ç½²æ€»è§ˆ

## ğŸ“š æ–‡æ¡£å¯¼èˆª

æ ¹æ®æ‚¨çš„éœ€æ±‚é€‰æ‹©åˆé€‚çš„æ–‡æ¡£ï¼š

| æ–‡æ¡£ | é€‚ç”¨åœºæ™¯ | é¢„è®¡æ—¶é—´ |
|------|---------|---------|
| [å¿«é€Ÿéƒ¨ç½²æŒ‡å—.md](./å¿«é€Ÿéƒ¨ç½²æŒ‡å—.md) | å·²æœ‰æœåŠ¡å™¨ç¯å¢ƒï¼Œå¿«é€Ÿéƒ¨ç½² | â±ï¸ 5-10åˆ†é’Ÿ |
| [DEPLOYMENT.md](./DEPLOYMENT.md) | å®Œæ•´çš„ç”Ÿäº§ç¯å¢ƒéƒ¨ç½² | â±ï¸ 30-60åˆ†é’Ÿ |
| [INSTALL.md](./INSTALL.md) | æœ¬åœ°å¼€å‘ç¯å¢ƒå®‰è£… | â±ï¸ 10-15åˆ†é’Ÿ |

---

## ğŸ¯ éƒ¨ç½²æ–¹å¼é€‰æ‹©

### æ–¹å¼1ï¸âƒ£ï¼šè‡ªåŠ¨åŒ–è„šæœ¬éƒ¨ç½²ï¼ˆæ¨èï¼‰

**é€‚ç”¨åœºæ™¯**ï¼šå·²æœ‰åŸºç¡€ç¯å¢ƒï¼Œéœ€è¦å¿«é€Ÿéƒ¨ç½²

```bash
# 1. ä¸Šä¼ ä»£ç åˆ°æœåŠ¡å™¨
scp -r backend deploy@your_server:/home/deploy/

# 2. SSH è¿æ¥æœåŠ¡å™¨
ssh deploy@your_server

# 3. é…ç½® .env æ–‡ä»¶
cd /home/deploy/backend
nano .env

# 4. ä¸€é”®éƒ¨ç½²
chmod +x deploy.sh
./deploy.sh init
```

**ä¼˜åŠ¿**ï¼š
- âœ… è‡ªåŠ¨åŒ–ç¨‹åº¦é«˜
- âœ… é”™è¯¯å¤„ç†å®Œå–„
- âœ… æ”¯æŒæ›´æ–°ã€å›æ»šç­‰æ“ä½œ

---

### æ–¹å¼2ï¸âƒ£ï¼šæ‰‹åŠ¨éƒ¨ç½²

**é€‚ç”¨åœºæ™¯**ï¼šéœ€è¦ç²¾ç»†æ§åˆ¶æ¯ä¸ªæ­¥éª¤

```bash
# 1. å®‰è£…ä¾èµ–
npm install --production

# 2. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
nano .env

# 3. åˆå§‹åŒ–æ•°æ®åº“
npm run init-db

# 4. å¯åŠ¨æœåŠ¡
pm2 start ecosystem.config.js
```

---

### æ–¹å¼3ï¸âƒ£ï¼šDocker éƒ¨ç½²ï¼ˆå³å°†æ¨å‡ºï¼‰

**é€‚ç”¨åœºæ™¯**ï¼šå®¹å™¨åŒ–éƒ¨ç½²ï¼Œç¯å¢ƒéš”ç¦»

```bash
# å³å°†æ”¯æŒ
docker-compose up -d
```

---

## ğŸ“‹ éƒ¨ç½²å‰æ£€æŸ¥æ¸…å•

åœ¨å¼€å§‹éƒ¨ç½²å‰ï¼Œè¯·ç¡®ä¿ï¼š

### æœåŠ¡å™¨ç¯å¢ƒ
- [ ] å·²è´­ä¹°äº‘æœåŠ¡å™¨ï¼ˆæ¨èé…ç½®ï¼š2æ ¸4Gï¼‰
- [ ] æ“ä½œç³»ç»Ÿï¼šUbuntu 20.04+ / CentOS 7+
- [ ] å·²å®‰è£… Node.js 14+
- [ ] å·²å®‰è£… MySQL 5.7+
- [ ] å·²å®‰è£… Nginx
- [ ] å·²å®‰è£… PM2
- [ ] å·²å®‰è£… Gitï¼ˆå¯é€‰ï¼‰

### åŸŸåä¸ç½‘ç»œ
- [ ] å·²æ³¨å†ŒåŸŸå
- [ ] åŸŸå DNS å·²è§£æåˆ°æœåŠ¡å™¨ IP
- [ ] é˜²ç«å¢™å·²å¼€æ”¾ 80ã€443 ç«¯å£
- [ ] SSH å¯ä»¥æ­£å¸¸è¿æ¥

### å¾®ä¿¡å°ç¨‹åº
- [ ] å·²æœ‰å¾®ä¿¡å°ç¨‹åº AppID
- [ ] å·²æœ‰å¾®ä¿¡å°ç¨‹åº AppSecret
- [ ] å‡†å¤‡å¥½é…ç½®æœåŠ¡å™¨åŸŸå

---

## ğŸ”§ æ ¸å¿ƒé…ç½®æ–‡ä»¶

### 1. ç¯å¢ƒå˜é‡é…ç½® (`.env`)

```env
# æ•°æ®åº“é…ç½®
DB_HOST=localhost
DB_USER=stoma_user
DB_PASSWORD=your_password
DB_NAME=stoma_care_db

# JWTå¯†é’¥
JWT_SECRET=your_secret_key

# å¾®ä¿¡é…ç½®
WECHAT_APPID=wx61ba15d015833945
WECHAT_SECRET=39dcc9d80a1ccbc94142d96519efad07

# æœåŠ¡å™¨é…ç½®
PORT=3000
NODE_ENV=production
```

### 2. PM2 é…ç½® (`ecosystem.config.js`)

```javascript
module.exports = {
  apps: [{
    name: 'stoma-care-backend',
    script: './src/server.js',
    instances: 2,
    exec_mode: 'cluster'
  }]
}
```

### 3. Nginx é…ç½®

```nginx
server {
    listen 443 ssl http2;
    server_name api.yourdomain.com;
    
    location /api {
        proxy_pass http://localhost:3000;
        # ... å…¶ä»–é…ç½®
    }
}
```

---

## ğŸ› ï¸ éƒ¨ç½²å·¥å…·ä½¿ç”¨

### è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬ (`deploy.sh`)

```bash
# æŸ¥çœ‹å¸®åŠ©
./deploy.sh help

# å¸¸ç”¨å‘½ä»¤
./deploy.sh init       # åˆå§‹åŒ–éƒ¨ç½²
./deploy.sh update     # æ›´æ–°ä»£ç 
./deploy.sh restart    # é‡å¯æœåŠ¡
./deploy.sh status     # æŸ¥çœ‹çŠ¶æ€
./deploy.sh logs       # æŸ¥çœ‹æ—¥å¿—
./deploy.sh backup     # å¤‡ä»½æ•°æ®åº“
./deploy.sh health     # å¥åº·æ£€æŸ¥
```

### PM2 å‘½ä»¤

```bash
# å¯åŠ¨
pm2 start ecosystem.config.js

# ç®¡ç†
pm2 restart stoma-care-backend
pm2 stop stoma-care-backend
pm2 delete stoma-care-backend

# ç›‘æ§
pm2 status
pm2 logs stoma-care-backend
pm2 monit

# å¼€æœºè‡ªå¯
pm2 startup
pm2 save
```

---

## ğŸ“Š éƒ¨ç½²æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å¾®ä¿¡å°ç¨‹åº                            â”‚
â”‚               (æ‚£è€…ç«¯ / æŠ¤å£«ç«¯)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚ HTTPS
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Nginx                               â”‚
â”‚            (åå‘ä»£ç† + HTTPS + è´Ÿè½½å‡è¡¡)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚ HTTP
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   PM2 (è¿›ç¨‹ç®¡ç†)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚  Node.js     â”‚  â”‚  Node.js     â”‚                    â”‚
â”‚  â”‚  Instance 1  â”‚  â”‚  Instance 2  â”‚  (é›†ç¾¤æ¨¡å¼)        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MySQL æ•°æ®åº“                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” å®‰å…¨å»ºè®®

### 1. ç¯å¢ƒå˜é‡å®‰å…¨
- âœ… ä½¿ç”¨å¼ºéšæœº JWT_SECRET
- âœ… .env æ–‡ä»¶æƒé™è®¾ä¸º 600
- âœ… ä¸è¦å°† .env æäº¤åˆ° Git

### 2. æ•°æ®åº“å®‰å…¨
- âœ… ä½¿ç”¨ä¸“ç”¨æ•°æ®åº“ç”¨æˆ·
- âœ… é™åˆ¶æ•°æ®åº“ä»…æœ¬åœ°è®¿é—®
- âœ… å®šæœŸå¤‡ä»½æ•°æ®

### 3. æœåŠ¡å™¨å®‰å…¨
- âœ… ä¿®æ”¹ SSH é»˜è®¤ç«¯å£
- âœ… ç¦ç”¨ root ç™»å½•
- âœ… é…ç½®é˜²ç«å¢™
- âœ… å®‰è£… fail2ban

### 4. HTTPS é…ç½®
- âœ… å¼ºåˆ¶ä½¿ç”¨ HTTPS
- âœ… é…ç½® SSL è¯ä¹¦
- âœ… å¯ç”¨ HSTS

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### 1. PM2 é›†ç¾¤æ¨¡å¼
ä½¿ç”¨å¤šä¸ª Node.js è¿›ç¨‹ï¼Œå……åˆ†åˆ©ç”¨å¤šæ ¸ CPU

### 2. Nginx ç¼“å­˜
å¯¹é™æ€èµ„æºå¯ç”¨ç¼“å­˜ï¼Œå‡å°‘åç«¯å‹åŠ›

### 3. æ•°æ®åº“ä¼˜åŒ–
- æ·»åŠ ç´¢å¼•
- ä¼˜åŒ–æŸ¥è¯¢
- é…ç½®è¿æ¥æ± 

### 4. å‹ç¼©ä¼ è¾“
å¯ç”¨ Gzip å‹ç¼©ï¼Œå‡å°‘ç½‘ç»œä¼ è¾“é‡

---

## ğŸ” ç›‘æ§ä¸æ—¥å¿—

### åº”ç”¨æ—¥å¿—
```bash
# PM2 æ—¥å¿—
pm2 logs

# åº”ç”¨æ—¥å¿—
tail -f logs/out.log
tail -f logs/err.log
```

### Nginx æ—¥å¿—
```bash
# è®¿é—®æ—¥å¿—
tail -f /var/log/nginx/stoma-care-access.log

# é”™è¯¯æ—¥å¿—
tail -f /var/log/nginx/stoma-care-error.log
```

### ç³»ç»Ÿç›‘æ§
```bash
# è¿›ç¨‹ç›‘æ§
pm2 monit

# ç³»ç»Ÿèµ„æº
htop
df -h
free -h
```

---

## ğŸ› æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜é€ŸæŸ¥

| é—®é¢˜ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|---------|---------|
| 502 Bad Gateway | åç«¯æœªå¯åŠ¨ | `pm2 restart` |
| æ•°æ®åº“è¿æ¥å¤±è´¥ | é…ç½®é”™è¯¯ | æ£€æŸ¥ `.env` |
| å¾®ä¿¡ç™»å½•å¤±è´¥ | AppID/Secreté”™è¯¯ | æ£€æŸ¥å¾®ä¿¡é…ç½® |
| æ–‡ä»¶ä¸Šä¼ å¤±è´¥ | æƒé™é—®é¢˜ | `chmod 755 uploads` |
| ç«¯å£è¢«å ç”¨ | å†²çª | `lsof -i :3000` |

### è¯Šæ–­å‘½ä»¤

```bash
# å¥åº·æ£€æŸ¥
./deploy.sh health

# æŸ¥çœ‹æ—¥å¿—
./deploy.sh logs

# æŸ¥çœ‹çŠ¶æ€
pm2 status

# æµ‹è¯• API
curl http://localhost:3000/api/health
```

---

## ğŸ“ è·å–å¸®åŠ©

### æ–‡æ¡£èµ„æº
- ğŸ“– [å®Œæ•´éƒ¨ç½²æŒ‡å—](./DEPLOYMENT.md)
- ğŸš€ [å¿«é€Ÿéƒ¨ç½²æŒ‡å—](./å¿«é€Ÿéƒ¨ç½²æŒ‡å—.md)
- ğŸ“¡ [API æ–‡æ¡£](./API.md)
- ğŸ”§ [å®‰è£…æŒ‡å—](./INSTALL.md)
- âš¡ [å¿«é€Ÿå¼€å§‹](./QUICKSTART.md)

### åœ¨çº¿èµ„æº
- PM2 å®˜æ–¹æ–‡æ¡£ï¼šhttps://pm2.keymetrics.io/
- Nginx æ–‡æ¡£ï¼šhttps://nginx.org/en/docs/
- Node.js æ–‡æ¡£ï¼šhttps://nodejs.org/docs/

---

## ğŸ¯ éƒ¨ç½²æ­¥éª¤æ€»ç»“

### æœ€å°åŒ–éƒ¨ç½²æµç¨‹ï¼ˆ5æ­¥ï¼‰

```bash
# 1. åˆ›å»ºæ•°æ®åº“
mysql -u root -p
CREATE DATABASE stoma_care_db;

# 2. é…ç½®ç¯å¢ƒå˜é‡
nano .env

# 3. å®‰è£…ä¾èµ–å¹¶åˆå§‹åŒ–
npm install --production
npm run init-db

# 4. å¯åŠ¨åº”ç”¨
pm2 start ecosystem.config.js

# 5. é…ç½® Nginx
sudo nano /etc/nginx/sites-available/stoma-care
sudo systemctl restart nginx
```

### å®Œæ•´éƒ¨ç½²æµç¨‹ï¼ˆæ¨èï¼‰

è¯·å‚è€ƒï¼š[å¿«é€Ÿéƒ¨ç½²æŒ‡å—.md](./å¿«é€Ÿéƒ¨ç½²æŒ‡å—.md)

---

## âœ… éªŒè¯éƒ¨ç½²

éƒ¨ç½²å®Œæˆåï¼Œè¯·éªŒè¯ï¼š

```bash
# 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€
pm2 status

# 2. æµ‹è¯• API
curl http://localhost:3000/api/health

# 3. æµ‹è¯• HTTPS
curl https://api.yourdomain.com/api/health

# 4. æŸ¥çœ‹æ—¥å¿—
pm2 logs --lines 20
```

---

## ğŸ‰ å¼€å§‹ä½¿ç”¨

éƒ¨ç½²æˆåŠŸåï¼š

1. **æ›´æ–°å°ç¨‹åºé…ç½®**
   - ä¿®æ”¹ `patientApp/config.js` ä¸­çš„ `apiBaseUrl`
   - æ›´æ–°ä¸º `https://api.yourdomain.com/api`

2. **é…ç½®å¾®ä¿¡å…¬ä¼—å¹³å°**
   - æ·»åŠ æœåŠ¡å™¨åŸŸåç™½åå•

3. **æµ‹è¯•åŠŸèƒ½**
   - å¾®ä¿¡ç™»å½•
   - API è°ƒç”¨
   - æ–‡ä»¶ä¸Šä¼ 

4. **ç›‘æ§è¿è¡Œ**
   ```bash
   ./deploy.sh status
   ./deploy.sh health
   ```

---

ç¥æ‚¨éƒ¨ç½²é¡ºåˆ©ï¼å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥é˜…è¯¦ç»†æ–‡æ¡£æˆ–è”ç³»æŠ€æœ¯æ”¯æŒã€‚ğŸš€



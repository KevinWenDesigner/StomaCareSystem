<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‚£è€…ç®¡ç†æ•°æ®å¤§å± - é€ å£æŠ¤ç†æ™ºèƒ½ç®¡ç†ç³»ç»Ÿ</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <!-- ç”Ÿäº§ç¯å¢ƒé…ç½®æ–‡ä»¶ -->
    <script src="config.prod.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', 'PingFang SC', Arial, sans-serif;
            background: #0a1628;
            color: #fff;
            overflow: hidden;
            height: 100vh;
            position: relative;
        }

        /* åŠ¨æ€èƒŒæ™¯ */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 30%, rgba(59, 130, 246, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(96, 165, 250, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(147, 197, 253, 0.1) 0%, transparent 70%);
            animation: backgroundPulse 15s ease-in-out infinite;
            z-index: 0;
        }

        @keyframes backgroundPulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        /* ç²’å­æ•ˆæœå®¹å™¨ */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 1;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 50%;
            animation: float linear infinite;
        }

        @keyframes float {
            0% {
                transform: translateY(100vh) scale(0);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) scale(1);
                opacity: 0;
            }
        }

        .dashboard-container {
            width: 100%;
            height: 100vh;
            padding: 1vh 1vw;
            display: flex;
            flex-direction: column;
            position: relative;
            z-index: 10;
        }

        /* å¤´éƒ¨ */
        .dashboard-header {
            text-align: center;
            margin-bottom: 1vh;
            padding: 1vh 2vw;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.15), rgba(96, 165, 250, 0.1));
            backdrop-filter: blur(20px);
            border-radius: 15px;
            border: 1px solid rgba(96, 165, 250, 0.3);
            box-shadow: 
                0 8px 32px rgba(59, 130, 246, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
            animation: headerGlow 3s ease-in-out infinite;
        }

        @keyframes headerGlow {
            0%, 100% {
                box-shadow: 
                    0 8px 32px rgba(59, 130, 246, 0.2),
                    inset 0 1px 0 rgba(255, 255, 255, 0.1);
            }
            50% {
                box-shadow: 
                    0 8px 40px rgba(59, 130, 246, 0.4),
                    inset 0 1px 0 rgba(255, 255, 255, 0.2);
            }
        }

        .dashboard-header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.05), transparent);
            animation: headerShine 3s linear infinite;
        }

        @keyframes headerShine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .dashboard-header h1 {
            font-size: clamp(1.3rem, 2.5vw, 2rem);
            font-weight: 700;
            text-shadow: 
                0 0 10px rgba(59, 130, 246, 0.8),
                0 0 20px rgba(96, 165, 250, 0.6),
                2px 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 0.3vh;
            position: relative;
            z-index: 1;
            background: linear-gradient(135deg, #fff, #60a5fa, #fff);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 3s ease-in-out infinite;
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .dashboard-header .subtitle {
            font-size: clamp(0.75rem, 1.3vw, 1rem);
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .dashboard-header .update-time {
            font-size: clamp(0.65rem, 1.1vw, 0.85rem);
            opacity: 0.7;
            position: absolute;
            top: 50%;
            right: 30px;
            transform: translateY(-50%);
            z-index: 1;
            color: #60a5fa;
            animation: blink 2s ease-in-out infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }

        /* ä¸»ä½“å†…å®¹ */
        .dashboard-body {
            flex: 1;
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 1vw;
            min-height: 0;
            overflow: hidden;
        }

        /* å·¦ä¾§æ  */
        .left-column {
            display: flex;
            flex-direction: column;
            gap: 1vh;
            min-height: 0;
        }

        /* ä¸­é—´æ  */
        .middle-column {
            display: flex;
            flex-direction: column;
            gap: 1vh;
            min-height: 0;
        }

        /* å³ä¾§æ  */
        .right-column {
            display: flex;
            flex-direction: column;
            gap: 1vh;
            min-height: 0;
        }

        /* å¡ç‰‡æ ·å¼ */
        .card {
            background: linear-gradient(135deg, rgba(30, 64, 175, 0.15), rgba(37, 99, 235, 0.08));
            backdrop-filter: blur(20px);
            border-radius: 15px;
            padding: 1vh 1vw;
            border: 1px solid rgba(96, 165, 250, 0.2);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.1), transparent);
            transition: left 0.6s;
        }

        .card:hover::before {
            left: 100%;
        }

        .card:hover {
            border-color: rgba(96, 165, 250, 0.5);
            box-shadow: 
                0 12px 40px rgba(59, 130, 246, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .card-title {
            font-size: clamp(1rem, 1.8vw, 1.3rem);
            font-weight: 600;
            margin-bottom: 0.8vh;
            padding-bottom: 0.5vh;
            border-bottom: 2px solid rgba(96, 165, 250, 0.3);
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
            flex-shrink: 0;
        }

        .card-title::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 60px;
            height: 2px;
            background: linear-gradient(90deg, #3b82f6, #60a5fa);
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.8);
            animation: titleGlow 2s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% {
                box-shadow: 0 0 10px rgba(59, 130, 246, 0.8);
                width: 60px;
            }
            50% {
                box-shadow: 0 0 20px rgba(59, 130, 246, 1);
                width: 80px;
            }
        }

        .card-title .icon {
            font-size: clamp(1.2rem, 2vw, 1.5rem);
            filter: drop-shadow(0 0 5px rgba(96, 165, 250, 0.8));
            animation: iconPulse 2s ease-in-out infinite;
        }

        @keyframes iconPulse {
            0%, 100% {
                transform: scale(1);
                filter: drop-shadow(0 0 5px rgba(96, 165, 250, 0.8));
            }
            50% {
                transform: scale(1.1);
                filter: drop-shadow(0 0 10px rgba(96, 165, 250, 1));
            }
        }

        /* ç»Ÿè®¡å¡ç‰‡ç½‘æ ¼ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.8vw;
            flex-shrink: 0;
        }

        .stat-item {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(37, 99, 235, 0.1));
            padding: 1vh 0.8vw;
            border-radius: 12px;
            text-align: center;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(96, 165, 250, 0.2);
            position: relative;
            overflow: hidden;
        }

        .stat-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, rgba(59, 130, 246, 0.3), transparent 70%);
            opacity: 0;
            transition: opacity 0.4s;
        }

        .stat-item:hover::before {
            opacity: 1;
        }

        .stat-item:hover {
            transform: translateY(-5px) scale(1.02);
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.3), rgba(37, 99, 235, 0.15));
            border-color: rgba(96, 165, 250, 0.5);
            box-shadow: 
                0 10px 30px rgba(59, 130, 246, 0.4),
                inset 0 0 20px rgba(59, 130, 246, 0.1);
        }

        .stat-value {
            font-size: clamp(1.8rem, 3.5vw, 2.8rem);
            font-weight: 700;
            margin-bottom: 0.5vh;
            background: linear-gradient(135deg, #fff, #60a5fa, #93c5fd);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: numberGlow 3s ease-in-out infinite;
            text-shadow: 0 0 30px rgba(59, 130, 246, 0.5);
            position: relative;
            z-index: 1;
            filter: drop-shadow(0 0 10px rgba(96, 165, 250, 0.8));
        }

        @keyframes numberGlow {
            0%, 100% {
                background-position: 0% 50%;
                filter: drop-shadow(0 0 10px rgba(96, 165, 250, 0.8));
            }
            50% {
                background-position: 100% 50%;
                filter: drop-shadow(0 0 20px rgba(59, 130, 246, 1));
            }
        }

        .stat-label {
            font-size: clamp(0.75rem, 1.2vw, 0.9rem);
            opacity: 0.9;
            position: relative;
            z-index: 1;
            color: #e0f2fe;
        }

        .stat-change {
            font-size: clamp(0.7rem, 1vw, 0.8rem);
            margin-top: 0.5vh;
            opacity: 0.8;
            position: relative;
            z-index: 1;
        }

        .stat-change.positive {
            color: #4ade80;
            text-shadow: 0 0 5px rgba(74, 222, 128, 0.5);
        }

        .stat-change.negative {
            color: #f87171;
            text-shadow: 0 0 5px rgba(248, 113, 113, 0.5);
        }

        /* å›¾è¡¨å®¹å™¨ */
        .chart-container {
            flex: 1;
            margin-top: 0.5vh;
            min-height: 220px;
            max-height: 35vh;
        }

        .chart-container-large {
            flex: 1;
            margin-top: 0.5vh;
            min-height: 300px;
            max-height: 48vh;
        }

        /* åˆ—è¡¨æ ·å¼ */
        .data-list {
            flex: 1;
            overflow-y: auto;
            min-height: 150px;
        }

        /* è‡ªåŠ¨æ»šåŠ¨åˆ—è¡¨æ ·å¼ */
        .data-list.auto-scroll {
            overflow: hidden;
            position: relative;
            mask-image: linear-gradient(to bottom, 
                transparent 0%, 
                black 5%, 
                black 95%, 
                transparent 100%);
            -webkit-mask-image: linear-gradient(to bottom, 
                transparent 0%, 
                black 5%, 
                black 95%, 
                transparent 100%);
        }

        .data-list.auto-scroll .scroll-content {
            animation: autoScroll 30s linear infinite;
            will-change: transform;
        }

        .data-list.auto-scroll:hover .scroll-content {
            animation-play-state: paused;
        }

        @keyframes autoScroll {
            0% {
                transform: translateY(0);
            }
            100% {
                transform: translateY(-50%);
            }
        }

        .data-list::-webkit-scrollbar {
            width: 8px;
        }

        .data-list::-webkit-scrollbar-track {
            background: rgba(59, 130, 246, 0.1);
            border-radius: 4px;
        }

        .data-list::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, rgba(59, 130, 246, 0.5), rgba(96, 165, 250, 0.5));
            border-radius: 4px;
            box-shadow: 0 0 6px rgba(59, 130, 246, 0.5);
        }

        .data-list::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, rgba(59, 130, 246, 0.7), rgba(96, 165, 250, 0.7));
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.8);
        }

        .list-item {
            padding: 0.8vh 0.8vw;
            margin-bottom: 0.8vh;
            background: linear-gradient(135deg, rgba(30, 64, 175, 0.2), rgba(37, 99, 235, 0.1));
            border-radius: 10px;
            border-left: 3px solid transparent;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .list-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.2), transparent);
            transition: left 0.5s;
        }

        .list-item:hover::before {
            left: 100%;
        }

        .list-item:hover {
            background: linear-gradient(135deg, rgba(30, 64, 175, 0.3), rgba(37, 99, 235, 0.15));
            transform: translateX(8px) scale(1.02);
            box-shadow: 
                -4px 0 15px rgba(59, 130, 246, 0.3),
                0 4px 20px rgba(0, 0, 0, 0.2);
        }

        .list-item.high-risk {
            border-left-color: #ef4444;
        }

        .list-item.high-risk:hover {
            box-shadow: 
                -4px 0 15px rgba(239, 68, 68, 0.5),
                0 4px 20px rgba(0, 0, 0, 0.2);
        }

        .list-item.medium-risk {
            border-left-color: #f59e0b;
        }

        .list-item.medium-risk:hover {
            box-shadow: 
                -4px 0 15px rgba(245, 158, 11, 0.5),
                0 4px 20px rgba(0, 0, 0, 0.2);
        }

        .list-item.low-risk {
            border-left-color: #10b981;
        }

        .list-item.low-risk:hover {
            box-shadow: 
                -4px 0 15px rgba(16, 185, 129, 0.5),
                0 4px 20px rgba(0, 0, 0, 0.2);
        }

        .list-item-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.3vh;
            position: relative;
            z-index: 1;
            align-items: center;
        }

        .list-item-name {
            font-weight: 600;
            font-size: clamp(0.8rem, 1.2vw, 0.95rem);
            color: #e0f2fe;
        }

        .list-item-badge {
            padding: 0.2vh 0.6vw;
            border-radius: 10px;
            font-size: clamp(0.65rem, 1vw, 0.75rem);
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            animation: badgePulse 2s ease-in-out infinite;
            white-space: nowrap;
        }

        @keyframes badgePulse {
            0%, 100% {
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            }
            50% {
                box-shadow: 0 2px 12px rgba(0, 0, 0, 0.5), 0 0 15px currentColor;
            }
        }

        .badge-high {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            box-shadow: 0 2px 8px rgba(239, 68, 68, 0.4);
        }

        .badge-medium {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            box-shadow: 0 2px 8px rgba(245, 158, 11, 0.4);
        }

        .badge-low {
            background: linear-gradient(135deg, #10b981, #059669);
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.4);
        }

        .list-item-info {
            font-size: clamp(0.7rem, 1vw, 0.8rem);
            opacity: 0.9;
            margin-top: 0.3vh;
            position: relative;
            z-index: 1;
            color: #bfdbfe;
            line-height: 1.4;
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 20vh;
            font-size: clamp(1rem, 1.5vw, 1.2rem);
            position: relative;
        }

        .loading::before {
            content: '';
            width: 50px;
            height: 50px;
            border: 3px solid rgba(59, 130, 246, 0.2);
            border-top-color: #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 15px;
        }

        .loading::after {
            content: 'åŠ è½½ä¸­...';
            animation: loadingPulse 1.5s ease-in-out infinite;
            color: #60a5fa;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes loadingPulse {
            0%, 100% { 
                opacity: 0.5; 
                text-shadow: 0 0 5px rgba(59, 130, 246, 0.3);
            }
            50% { 
                opacity: 1; 
                text-shadow: 0 0 15px rgba(59, 130, 246, 0.8);
            }
        }

        /* ç©ºæ•°æ®æç¤º */
        .empty-data {
            text-align: center;
            padding: 4vh 2vw;
            opacity: 0.6;
            font-size: clamp(0.85rem, 1.3vw, 0.95rem);
            color: #93c5fd;
            animation: fadeInOut 2s ease-in-out infinite;
        }

        @keyframes fadeInOut {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 0.8; }
        }

        /* å“åº”å¼ */
        @media (min-width: 1920px) {
            .dashboard-container {
                padding: 1.2vh 1.5vw;
            }
            
            .chart-container {
                min-height: 280px;
            }

            .chart-container-large {
                min-height: 380px;
            }
        }

        @media (max-width: 1600px) {
            .dashboard-body {
                grid-template-columns: 1fr 1.5fr 1fr;
            }
            
            .dashboard-header h1 {
                font-size: 1.8rem;
            }
        }

        @media (max-width: 1200px) {
            .dashboard-body {
                grid-template-columns: 1fr;
                overflow-y: auto;
                gap: 15px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(4, 1fr);
            }

            .card {
                padding: 15px;
            }

            .chart-container {
                height: 250px;
                max-height: none;
            }

            .chart-container-large {
                height: 300px;
                max-height: none;
            }
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .dashboard-header h1 {
                font-size: 1.5rem;
            }
        }

        /* æ•°æ®åŠ¨ç”» */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .card {
            animation: fadeIn 0.6s ease-out backwards;
        }

        .left-column .card:nth-child(1) { animation-delay: 0.1s; }
        .left-column .card:nth-child(2) { animation-delay: 0.2s; }
        .left-column .card:nth-child(3) { animation-delay: 0.3s; }
        .middle-column .card:nth-child(1) { animation-delay: 0.2s; }
        .middle-column .card:nth-child(2) { animation-delay: 0.3s; }
        .right-column .card:nth-child(1) { animation-delay: 0.3s; }
        .right-column .card:nth-child(2) { animation-delay: 0.4s; }
        .right-column .card:nth-child(3) { animation-delay: 0.5s; }

        /* æç¤ºæ¡† */
        .tooltip {
            position: fixed;
            background: linear-gradient(135deg, rgba(30, 64, 175, 0.95), rgba(37, 99, 235, 0.95));
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.9rem;
            pointer-events: none;
            z-index: 1000;
            display: none;
            border: 1px solid rgba(96, 165, 250, 0.3);
            box-shadow: 0 4px 20px rgba(59, 130, 246, 0.4);
        }

        /* é”™è¯¯æç¤º */
        .error-message {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(220, 38, 38, 0.1));
            border: 1px solid rgba(239, 68, 68, 0.5);
            color: #fca5a5;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            margin: 20px;
            box-shadow: 0 4px 20px rgba(239, 68, 68, 0.3);
            animation: fadeIn 0.5s ease-out;
        }

        /* æ•°æ®åˆ·æ–°åŠ¨ç”» */
        .data-refresh {
            animation: dataRefresh 0.5s ease-out;
        }

        @keyframes dataRefresh {
            0% {
                opacity: 0.5;
                transform: scale(0.98);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }
    </style>
</head>
<body>
    <!-- ç²’å­èƒŒæ™¯ -->
    <div class="particles" id="particles"></div>

    <div class="dashboard-container">
        <!-- å¤´éƒ¨ -->
        <div class="dashboard-header">
            <h1>ğŸ¥ æ‚£è€…ç®¡ç†æ•°æ®å¤§å±</h1>
            <div class="subtitle">é€ å£æŠ¤ç†æ™ºèƒ½ç®¡ç†ç³»ç»Ÿ - å®æ—¶æ•°æ®ç›‘æ§</div>
            <div class="update-time" id="updateTime">æœ€åæ›´æ–°: --</div>
        </div>

        <!-- ä¸»ä½“ -->
        <div class="dashboard-body" id="dashboardBody">
            <!-- å·¦ä¾§æ  -->
            <div class="left-column">
                <!-- æ ¸å¿ƒç»Ÿè®¡ -->
                <div class="card">
                    <div class="card-title">
                        <span class="icon">ğŸ“Š</span>
                        <span>æ ¸å¿ƒæŒ‡æ ‡</span>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value" id="totalPatients">0</div>
                            <div class="stat-label">æ€»æ‚£è€…æ•°</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="activePatients">0</div>
                            <div class="stat-label">æ´»è·ƒæ‚£è€…</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="totalAssessments">0</div>
                            <div class="stat-label">æ€»è¯„ä¼°æ¬¡æ•°</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="pendingReviews">0</div>
                            <div class="stat-label">å¾…å®¡æ ¸</div>
                        </div>
                    </div>
                </div>

                <!-- ä»Šæ—¥æ•°æ® -->
                <div class="card">
                    <div class="card-title">
                        <span class="icon">ğŸ“…</span>
                        <span>ä»Šæ—¥æ•°æ®</span>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value" id="todayAssessments">0</div>
                            <div class="stat-label">ä»Šæ—¥è¯„ä¼°</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="todayDiaries">0</div>
                            <div class="stat-label">ä»Šæ—¥æ—¥è®°</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="weekAssessments">0</div>
                            <div class="stat-label">æœ¬å‘¨è¯„ä¼°</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="avgScore">0</div>
                            <div class="stat-label">å¹³å‡è¯„åˆ†</div>
                        </div>
                    </div>
                </div>

                <!-- é£é™©ç­‰çº§åˆ†å¸ƒ -->
                <div class="card" style="flex: 1;">
                    <div class="card-title">
                        <span class="icon">âš ï¸</span>
                        <span>é£é™©ç­‰çº§åˆ†å¸ƒ</span>
                    </div>
                    <div class="chart-container" id="riskChart"></div>
                </div>
            </div>

            <!-- ä¸­é—´æ  -->
            <div class="middle-column">
                <!-- è¯„ä¼°è¶‹åŠ¿ -->
                <div class="card" style="flex: 1;">
                    <div class="card-title">
                        <span class="icon">ğŸ“ˆ</span>
                        <span>è¯„ä¼°è¶‹åŠ¿åˆ†æï¼ˆè¿‘7å¤©ï¼‰</span>
                    </div>
                    <div class="chart-container-large" id="trendChart"></div>
                </div>

                <!-- NPUAPåˆ†æœŸç»Ÿè®¡ -->
                <div class="card" style="flex: 1;">
                    <div class="card-title">
                        <span class="icon">ğŸ“‹</span>
                        <span>NPUAPåˆ†æœŸåˆ†å¸ƒ</span>
                    </div>
                    <div class="chart-container" id="stageChart"></div>
                </div>
            </div>

            <!-- å³ä¾§æ  -->
            <div class="right-column">
                <!-- é€ å£ç±»å‹åˆ†å¸ƒ -->
                <div class="card">
                    <div class="card-title">
                        <span class="icon">ğŸ”</span>
                        <span>é€ å£ç±»å‹</span>
                    </div>
                    <div class="chart-container" id="stomaTypeChart"></div>
                </div>

                <!-- é«˜é£é™©æ‚£è€… -->
                <div class="card" style="flex: 1;">
                    <div class="card-title">
                        <span class="icon">ğŸš¨</span>
                        <span>é«˜é£é™©æ‚£è€…</span>
                    </div>
                    <div class="data-list" id="highRiskList"></div>
                </div>

                <!-- å¾…å®¡æ ¸è¯„ä¼° -->
                <div class="card" style="flex: 1;">
                    <div class="card-title">
                        <span class="icon">â°</span>
                        <span>å¾…å®¡æ ¸è¯„ä¼°</span>
                    </div>
                    <div class="data-list" id="pendingList"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // é…ç½® - ä¼˜å…ˆä½¿ç”¨å¤–éƒ¨é…ç½®ï¼Œç„¶åæ˜¯localStorageï¼Œæœ€åæ˜¯é»˜è®¤å€¼
        const CONFIG = {
            apiBaseUrl: (window.DASHBOARD_CONFIG && window.DASHBOARD_CONFIG.apiBaseUrl) || 
                        localStorage.getItem('apiBaseUrl') || 
                        'http://localhost:3000/api',
            refreshInterval: (window.DASHBOARD_CONFIG && window.DASHBOARD_CONFIG.refreshInterval) || 30000,
            token: localStorage.getItem('token') || ''
        };

        // åˆ›å»ºç²’å­èƒŒæ™¯
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = 30;

            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                // éšæœºå¤§å°
                const size = Math.random() * 4 + 2;
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                
                // éšæœºä½ç½®
                particle.style.left = `${Math.random() * 100}%`;
                
                // éšæœºåŠ¨ç”»æ—¶é•¿
                const duration = Math.random() * 20 + 15;
                particle.style.animationDuration = `${duration}s`;
                
                // éšæœºå»¶è¿Ÿ
                const delay = Math.random() * 10;
                particle.style.animationDelay = `${delay}s`;
                
                particlesContainer.appendChild(particle);
            }
        }

        // æ•°å­—æ»šåŠ¨åŠ¨ç”»
        function animateNumber(element, target, duration = 1000) {
            const start = parseInt(element.textContent) || 0;
            
            // å¦‚æœç›®æ ‡å€¼ä¸å½“å‰å€¼ç›¸åŒï¼Œä¸æ‰§è¡ŒåŠ¨ç”»
            if (start === target) {
                return;
            }
            
            const increment = (target - start) / (duration / 16);
            let current = start;
            
            // æ¸…é™¤å¯èƒ½å­˜åœ¨çš„æ—§å®šæ—¶å™¨
            if (element.animationTimer) {
                clearInterval(element.animationTimer);
            }
            
            element.animationTimer = setInterval(() => {
                current += increment;
                if ((increment > 0 && current >= target) || (increment < 0 && current <= target)) {
                    element.textContent = target;
                    clearInterval(element.animationTimer);
                    element.animationTimer = null;
                } else {
                    element.textContent = Math.round(current);
                }
            }, 16);
        }

        // æ•°å­—æ»šåŠ¨åŠ¨ç”»ï¼ˆæ”¯æŒå°æ•°ï¼‰
        function animateNumberDecimal(element, target, duration = 1000, decimals = 1) {
            const start = parseFloat(element.textContent) || 0;
            
            // å¦‚æœç›®æ ‡å€¼ä¸å½“å‰å€¼ç›¸åŒï¼ˆå…è®¸å°è¯¯å·®ï¼‰ï¼Œä¸æ‰§è¡ŒåŠ¨ç”»
            if (Math.abs(start - target) < 0.01) {
                element.textContent = target.toFixed(decimals);
                return;
            }
            
            const increment = (target - start) / (duration / 16);
            let current = start;
            
            // æ¸…é™¤å¯èƒ½å­˜åœ¨çš„æ—§å®šæ—¶å™¨
            if (element.animationTimer) {
                clearInterval(element.animationTimer);
            }
            
            element.animationTimer = setInterval(() => {
                current += increment;
                if ((increment > 0 && current >= target) || (increment < 0 && current <= target)) {
                    element.textContent = target.toFixed(decimals);
                    clearInterval(element.animationTimer);
                    element.animationTimer = null;
                } else {
                    element.textContent = current.toFixed(decimals);
                }
            }, 16);
        }

        // APIè¯·æ±‚å°è£…
        async function fetchAPI(endpoint) {
            try {
                const response = await fetch(`${CONFIG.apiBaseUrl}${endpoint}`, {
                    headers: {
                        'Authorization': `Bearer ${CONFIG.token}`,
                        'Content-Type': 'application/json'
                    }
                });

                // å¦‚æœæ˜¯ 401/403ï¼Œè¯´æ˜ token æ— æ•ˆ
                if (response.status === 401 || response.status === 403) {
                    console.error('Token æ— æ•ˆæˆ–å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•');
                    // æ¸…é™¤ token
                    localStorage.removeItem('token');
                    localStorage.removeItem('userInfo');
                    // è®¾ç½®æ ‡è®°ï¼Œè¡¨ç¤ºæ˜¯ä» index è·³è½¬åˆ° login
                    sessionStorage.setItem('fromIndex', 'true');
                    // è·³è½¬åˆ°ç™»å½•é¡µ
                    alert('ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•');
                    window.location.href = 'login.html';
                    return;
                }

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                return data;
            } catch (error) {
                console.error('APIè¯·æ±‚å¤±è´¥:', error);
                throw error;
            }
        }

        // åˆå§‹åŒ–å›¾è¡¨
        const charts = {
            risk: null,
            trend: null,
            stage: null,
            stomaType: null
        };

        // åˆå§‹åŒ–æ‰€æœ‰å›¾è¡¨
        function initCharts() {
            charts.risk = echarts.init(document.getElementById('riskChart'));
            charts.trend = echarts.init(document.getElementById('trendChart'));
            charts.stage = echarts.init(document.getElementById('stageChart'));
            charts.stomaType = echarts.init(document.getElementById('stomaTypeChart'));

            // å“åº”å¼
            window.addEventListener('resize', () => {
                Object.values(charts).forEach(chart => chart && chart.resize());
            });
        }

        // æ›´æ–°æ ¸å¿ƒç»Ÿè®¡æ•°æ®
        function updateCoreStats(data) {
            const { patientStats, assessmentStats } = data;

            // ä½¿ç”¨åŠ¨ç”»æ›´æ–°æ•°å­—ï¼ˆåªæœ‰æ•°å€¼å˜åŒ–æ—¶æ‰ä¼šæœ‰åŠ¨ç”»æ•ˆæœï¼‰
            animateNumber(document.getElementById('totalPatients'), patientStats.total_patients || 0);
            animateNumber(document.getElementById('activePatients'), patientStats.active_patients || 0);
            animateNumber(document.getElementById('totalAssessments'), assessmentStats.total_assessments || 0);
            animateNumber(document.getElementById('pendingReviews'), assessmentStats.pending_review || 0);

            animateNumber(document.getElementById('todayAssessments'), assessmentStats.today_assessments || 0);
            animateNumber(document.getElementById('weekAssessments'), assessmentStats.week_assessments || 0);
            animateNumberDecimal(document.getElementById('avgScore'), Number(assessmentStats.avg_score) || 0, 1000, 1);
        }

        // æ›´æ–°ä»Šæ—¥æ•°æ®
        async function updateTodayData() {
            try {
                const result = await fetchAPI('/dashboard/realtime');
                if (result.success && result.data) {
                    const { todayData } = result.data;
                    animateNumber(document.getElementById('todayDiaries'), todayData.today_diaries || 0);
                }
            } catch (error) {
                console.error('è·å–ä»Šæ—¥æ•°æ®å¤±è´¥:', error);
            }
        }

        // æ›´æ–°é£é™©åˆ†å¸ƒå›¾è¡¨
        function updateRiskChart(riskDistribution) {
            if (!charts.risk) return;
            
            const riskMap = {
                'ä½é£é™©': { value: 0, color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                    {offset: 0, color: '#10b981'},
                    {offset: 1, color: '#059669'}
                ])},
                'ä¸­é£é™©': { value: 0, color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                    {offset: 0, color: '#f59e0b'},
                    {offset: 1, color: '#d97706'}
                ])},
                'é«˜é£é™©': { value: 0, color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                    {offset: 0, color: '#ef4444'},
                    {offset: 1, color: '#dc2626'}
                ])}
            };

            riskDistribution.forEach(item => {
                if (riskMap[item.risk_level]) {
                    riskMap[item.risk_level].value = item.count;
                }
            });

            const option = {
                tooltip: {
                    trigger: 'item',
                    formatter: '{b}: {c} ({d}%)',
                    backgroundColor: 'rgba(30, 64, 175, 0.95)',
                    borderColor: 'rgba(96, 165, 250, 0.5)',
                    textStyle: {
                        color: '#fff'
                    }
                },
                legend: {
                    orient: 'vertical',
                    right: 10,
                    top: 'center',
                    textStyle: {
                        color: '#e0f2fe',
                        fontSize: 12
                    }
                },
                series: [{
                    type: 'pie',
                    radius: ['40%', '70%'],
                    center: ['40%', '50%'],
                    data: [
                        { value: riskMap['ä½é£é™©'].value, name: 'ä½é£é™©', itemStyle: { color: riskMap['ä½é£é™©'].color } },
                        { value: riskMap['ä¸­é£é™©'].value, name: 'ä¸­é£é™©', itemStyle: { color: riskMap['ä¸­é£é™©'].color } },
                        { value: riskMap['é«˜é£é™©'].value, name: 'é«˜é£é™©', itemStyle: { color: riskMap['é«˜é£é™©'].color } }
                    ],
                    emphasis: {
                        itemStyle: {
                            shadowBlur: 20,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(59, 130, 246, 0.8)'
                        },
                        scale: true,
                        scaleSize: 10
                    },
                    label: {
                        color: '#fff',
                        fontSize: 12,
                        formatter: '{b}\n{d}%'
                    },
                    labelLine: {
                        lineStyle: {
                            color: 'rgba(255, 255, 255, 0.5)'
                        }
                    },
                    animationType: 'scale',
                    animationEasing: 'elasticOut',
                    animationDelay: function (idx) {
                        return idx * 200;
                    }
                }]
            };

            // ä½¿ç”¨ notMerge: false æ¥æ›´æ–°è€Œä¸æ˜¯å®Œå…¨æ›¿æ¢ï¼Œå‡å°‘é—ªçƒ
            charts.risk.setOption(option, { notMerge: false, lazyUpdate: true });
        }

        // æ›´æ–°è¶‹åŠ¿å›¾è¡¨
        function updateTrendChart(assessmentTrend) {
            if (!charts.trend) return;
            
            const dates = assessmentTrend.map(item => {
                const date = new Date(item.date);
                return `${date.getMonth() + 1}/${date.getDate()}`;
            });
            const counts = assessmentTrend.map(item => item.count);
            const scores = assessmentTrend.map(item => (Number(item.avg_score) || 0).toFixed(1));

            const option = {
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'cross',
                        crossStyle: {
                            color: 'rgba(96, 165, 250, 0.5)'
                        },
                        lineStyle: {
                            color: 'rgba(96, 165, 250, 0.5)'
                        }
                    },
                    backgroundColor: 'rgba(30, 64, 175, 0.95)',
                    borderColor: 'rgba(96, 165, 250, 0.5)',
                    textStyle: {
                        color: '#fff'
                    }
                },
                legend: {
                    data: ['è¯„ä¼°æ¬¡æ•°', 'å¹³å‡è¯„åˆ†'],
                    textStyle: {
                        color: '#e0f2fe',
                        fontSize: 12
                    },
                    top: 0
                },
                grid: {
                    left: '5%',
                    right: '5%',
                    bottom: '8%',
                    top: '12%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    boundaryGap: false,
                    data: dates,
                    axisLine: {
                        lineStyle: {
                            color: 'rgba(96, 165, 250, 0.5)',
                            width: 2
                        }
                    },
                    axisLabel: {
                        color: '#e0f2fe',
                        fontSize: 11
                    },
                    axisTick: {
                        lineStyle: {
                            color: 'rgba(96, 165, 250, 0.3)'
                        }
                    }
                },
                yAxis: [
                    {
                        type: 'value',
                        name: 'è¯„ä¼°æ¬¡æ•°',
                        position: 'left',
                        nameTextStyle: {
                            color: '#4ade80',
                            fontSize: 12
                        },
                        axisLine: {
                            lineStyle: {
                                color: 'rgba(74, 222, 128, 0.5)',
                                width: 2
                            }
                        },
                        axisLabel: {
                            color: '#e0f2fe',
                            fontSize: 11
                        },
                        splitLine: {
                            lineStyle: {
                                color: 'rgba(96, 165, 250, 0.1)',
                                type: 'dashed'
                            }
                        }
                    },
                    {
                        type: 'value',
                        name: 'å¹³å‡è¯„åˆ†',
                        position: 'right',
                        max: 100,
                        nameTextStyle: {
                            color: '#60a5fa',
                            fontSize: 12
                        },
                        axisLine: {
                            lineStyle: {
                                color: 'rgba(96, 165, 250, 0.5)',
                                width: 2
                            }
                        },
                        axisLabel: {
                            color: '#e0f2fe',
                            fontSize: 11
                        },
                        splitLine: {
                            show: false
                        }
                    }
                ],
                series: [
                    {
                        name: 'è¯„ä¼°æ¬¡æ•°',
                        type: 'line',
                        smooth: true,
                        data: counts,
                        yAxisIndex: 0,
                        symbolSize: 8,
                        itemStyle: {
                            color: '#4ade80',
                            shadowBlur: 10,
                            shadowColor: 'rgba(74, 222, 128, 0.8)'
                        },
                        lineStyle: {
                            width: 3,
                            shadowBlur: 10,
                            shadowColor: 'rgba(74, 222, 128, 0.5)'
                        },
                        areaStyle: {
                            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                {offset: 0, color: 'rgba(74, 222, 128, 0.6)'},
                                {offset: 1, color: 'rgba(74, 222, 128, 0.05)'}
                            ]),
                            shadowBlur: 20,
                            shadowColor: 'rgba(74, 222, 128, 0.3)'
                        },
                        emphasis: {
                            focus: 'series',
                            itemStyle: {
                                shadowBlur: 20,
                                shadowColor: 'rgba(74, 222, 128, 1)'
                            }
                        },
                        animationDelay: function (idx) {
                            return idx * 50;
                        }
                    },
                    {
                        name: 'å¹³å‡è¯„åˆ†',
                        type: 'line',
                        smooth: true,
                        data: scores,
                        yAxisIndex: 1,
                        symbolSize: 8,
                        itemStyle: {
                            color: '#60a5fa',
                            shadowBlur: 10,
                            shadowColor: 'rgba(96, 165, 250, 0.8)'
                        },
                        lineStyle: {
                            width: 3,
                            shadowBlur: 10,
                            shadowColor: 'rgba(96, 165, 250, 0.5)'
                        },
                        emphasis: {
                            focus: 'series',
                            itemStyle: {
                                shadowBlur: 20,
                                shadowColor: 'rgba(96, 165, 250, 1)'
                            }
                        },
                        animationDelay: function (idx) {
                            return idx * 50 + 300;
                        }
                    }
                ],
                animationEasing: 'elasticOut',
                animationDuration: 1000
            };

            charts.trend.setOption(option, { notMerge: false, lazyUpdate: true });
        }

        // æ›´æ–°NPUAPåˆ†æœŸå›¾è¡¨
        function updateStageChart(stageDistribution) {
            if (!charts.stage) return;
            
            // NPUAPåˆ†æœŸä¸­è‹±æ–‡æ˜ å°„
            const stageNameMap = {
                'dtpi': 'DTPI(æ·±éƒ¨ç»„ç»‡æŸä¼¤)',
                'invalid': 'æ— æ³•åˆ†æœŸ',
                'normal': 'æ­£å¸¸',
                'stage_1': 'ä¸€æœŸ',
                'stage_2': 'äºŒæœŸ',
                'stage_3': 'ä¸‰æœŸ',
                'stage_4': 'å››æœŸ',
                'stage 1': 'ä¸€æœŸ',
                'stage 2': 'äºŒæœŸ',
                'stage 3': 'ä¸‰æœŸ',
                'stage 4': 'å››æœŸ',
                'Stage 1': 'ä¸€æœŸ',
                'Stage 2': 'äºŒæœŸ',
                'Stage 3': 'ä¸‰æœŸ',
                'Stage 4': 'å››æœŸ',
                'stage1': 'ä¸€æœŸ',
                'stage2': 'äºŒæœŸ',
                'stage3': 'ä¸‰æœŸ',
                'stage4': 'å››æœŸ'
            };
            
            const stages = stageDistribution.map(item => {
                const originalStage = item.pressure_stage || 'æœªçŸ¥';
                return stageNameMap[originalStage] || originalStage;
            });
            const counts = stageDistribution.map(item => item.count);

            const option = {
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'shadow',
                        shadowStyle: {
                            color: 'rgba(59, 130, 246, 0.2)'
                        }
                    },
                    backgroundColor: 'rgba(30, 64, 175, 0.95)',
                    borderColor: 'rgba(96, 165, 250, 0.5)',
                    textStyle: {
                        color: '#fff'
                    }
                },
                grid: {
                    left: '5%',
                    right: '5%',
                    bottom: '12%',
                    top: '8%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: stages,
                    axisLine: {
                        lineStyle: {
                            color: 'rgba(96, 165, 250, 0.5)',
                            width: 2
                        }
                    },
                    axisLabel: {
                        color: '#e0f2fe',
                        rotate: 0,
                        fontSize: 11,
                        interval: 0,
                        formatter: function(value) {
                            // å¦‚æœæ ‡ç­¾è¿‡é•¿ï¼Œè¿›è¡Œæ¢è¡Œå¤„ç†
                            if (value.length > 6) {
                                // ä¼˜å…ˆåœ¨æ‹¬å·å¤„æ¢è¡Œ
                                if (value.includes('(')) {
                                    return value.replace('(', '\n(');
                                }
                                // å¦åˆ™åœ¨ä¸­é—´ä½ç½®æ¢è¡Œ
                                const mid = Math.ceil(value.length / 2);
                                return value.substring(0, mid) + '\n' + value.substring(mid);
                            }
                            return value;
                        }
                    },
                    axisTick: {
                        lineStyle: {
                            color: 'rgba(96, 165, 250, 0.3)'
                        }
                    }
                },
                yAxis: {
                    type: 'value',
                    axisLine: {
                        lineStyle: {
                            color: 'rgba(96, 165, 250, 0.5)',
                            width: 2
                        }
                    },
                    axisLabel: {
                        color: '#e0f2fe',
                        fontSize: 11
                    },
                    splitLine: {
                        lineStyle: {
                            color: 'rgba(96, 165, 250, 0.1)',
                            type: 'dashed'
                        }
                    }
                },
                series: [{
                    type: 'bar',
                    data: counts,
                    barWidth: '50%',
                    itemStyle: {
                        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                            {offset: 0, color: '#60a5fa'},
                            {offset: 1, color: '#3b82f6'}
                        ]),
                        borderRadius: [8, 8, 0, 0],
                        shadowBlur: 10,
                        shadowColor: 'rgba(59, 130, 246, 0.5)'
                    },
                    emphasis: {
                        itemStyle: {
                            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                {offset: 0, color: '#93c5fd'},
                                {offset: 1, color: '#60a5fa'}
                            ]),
                            shadowBlur: 20,
                            shadowColor: 'rgba(59, 130, 246, 0.8)'
                        }
                    },
                    animationDelay: function (idx) {
                        return idx * 100;
                    }
                }],
                animationEasing: 'elasticOut',
                animationDuration: 800
            };

            charts.stage.setOption(option, { notMerge: false, lazyUpdate: true });
        }

        // æ›´æ–°é€ å£ç±»å‹å›¾è¡¨
        function updateStomaTypeChart(stomaTypeDistribution) {
            if (!charts.stomaType) return;
            
            // é€ å£ç±»å‹ä¸­è‹±æ–‡æ˜ å°„
            const stomaTypeMap = {
                'colostomy': 'ç»“è‚ é€ å£',
                'ileostomy': 'å›è‚ é€ å£',
                'urostomy': 'æ³Œå°¿é€ å£',
                'gastrostomy': 'èƒƒé€ å£',
                'jejunostomy': 'ç©ºè‚ é€ å£',
                'tracheostomy': 'æ°”ç®¡é€ å£'
            };
            
            const types = stomaTypeDistribution.map(item => {
                const originalType = item.stoma_type || 'æœªçŸ¥';
                return stomaTypeMap[originalType] || originalType;
            });
            const counts = stomaTypeDistribution.map(item => item.count);

            // è“ç™½è‰²ç³»é…è‰²
            const colors = [
                new echarts.graphic.LinearGradient(0, 0, 1, 1, [
                    {offset: 0, color: '#60a5fa'},
                    {offset: 1, color: '#3b82f6'}
                ]),
                new echarts.graphic.LinearGradient(0, 0, 1, 1, [
                    {offset: 0, color: '#93c5fd'},
                    {offset: 1, color: '#60a5fa'}
                ]),
                new echarts.graphic.LinearGradient(0, 0, 1, 1, [
                    {offset: 0, color: '#dbeafe'},
                    {offset: 1, color: '#93c5fd'}
                ]),
                new echarts.graphic.LinearGradient(0, 0, 1, 1, [
                    {offset: 0, color: '#3b82f6'},
                    {offset: 1, color: '#2563eb'}
                ])
            ];

            const option = {
                tooltip: {
                    trigger: 'item',
                    formatter: '{b}: {c} ({d}%)',
                    backgroundColor: 'rgba(30, 64, 175, 0.95)',
                    borderColor: 'rgba(96, 165, 250, 0.5)',
                    textStyle: {
                        color: '#fff'
                    }
                },
                legend: {
                    orient: 'vertical',
                    right: 10,
                    top: 'center',
                    textStyle: {
                        color: '#e0f2fe',
                        fontSize: 11
                    }
                },
                series: [{
                    type: 'pie',
                    radius: ['35%', '65%'],
                    center: ['40%', '50%'],
                    data: types.map((type, index) => ({
                        value: counts[index],
                        name: type,
                        itemStyle: {
                            color: colors[index % colors.length],
                            shadowBlur: 10,
                            shadowColor: 'rgba(59, 130, 246, 0.5)'
                        }
                    })),
                    emphasis: {
                        itemStyle: {
                            shadowBlur: 20,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(59, 130, 246, 0.8)'
                        },
                        scale: true,
                        scaleSize: 10
                    },
                    label: {
                        color: '#fff',
                        fontSize: 11,
                        formatter: '{b}\n{d}%'
                    },
                    labelLine: {
                        lineStyle: {
                            color: 'rgba(255, 255, 255, 0.5)'
                        }
                    },
                    animationType: 'scale',
                    animationEasing: 'elasticOut',
                    animationDelay: function (idx) {
                        return idx * 150;
                    }
                }]
            };

            charts.stomaType.setOption(option, { notMerge: false, lazyUpdate: true });
        }

        // æ›´æ–°é«˜é£é™©æ‚£è€…åˆ—è¡¨
        function updateHighRiskList(highRiskPatients) {
            const listContainer = document.getElementById('highRiskList');
            
            if (!highRiskPatients || highRiskPatients.length === 0) {
                listContainer.innerHTML = '<div class="empty-data">æš‚æ— é«˜é£é™©æ‚£è€…</div>';
                listContainer.classList.remove('auto-scroll');
                return;
            }

            const html = highRiskPatients.map(patient => {
                const riskClass = patient.risk_level === 'é«˜é£é™©' ? 'high-risk' : 
                                patient.risk_level === 'ä¸­é£é™©' ? 'medium-risk' : 'low-risk';
                const badgeClass = patient.risk_level === 'é«˜é£é™©' ? 'badge-high' : 
                                  patient.risk_level === 'ä¸­é£é™©' ? 'badge-medium' : 'badge-low';
                const date = new Date(patient.assessment_date);
                const dateStr = `${date.getMonth() + 1}/${date.getDate()} ${date.getHours()}:${String(date.getMinutes()).padStart(2, '0')}`;
                
                // å°†è‹±æ–‡çŠ¶æ€è½¬æ¢ä¸ºä¸­æ–‡
                const stageText = getStageTextChinese(patient.pressure_stage);

                return `
                    <div class="list-item ${riskClass}">
                        <div class="list-item-header">
                            <span class="list-item-name">${patient.name}</span>
                            <span class="list-item-badge ${badgeClass}">${patient.risk_level}</span>
                        </div>
                        <div class="list-item-info">
                            è¯„åˆ†: ${patient.score} | ${stageText}<br>
                            ${patient.stoma_type || 'æœªçŸ¥ç±»å‹'} | ${dateStr}
                        </div>
                    </div>
                `;
            }).join('');

            // å¦‚æœæ•°æ®è¶…è¿‡3æ¡ï¼Œå¯ç”¨è‡ªåŠ¨æ»šåŠ¨
            if (highRiskPatients.length >= 3) {
                listContainer.classList.add('auto-scroll');
                // å¤åˆ¶å†…å®¹å®ç°æ— é™å¾ªç¯æ»šåŠ¨
                listContainer.innerHTML = `<div class="scroll-content">${html}${html}</div>`;
            } else {
                listContainer.classList.remove('auto-scroll');
                listContainer.innerHTML = html;
            }
        }

        // NPUAPåˆ†æœŸçŠ¶æ€æ˜ å°„ï¼ˆè‹±æ–‡è½¬ä¸­æ–‡ï¼‰
        function getStageTextChinese(stage) {
            const stageMap = {
                'normal': 'æ­£å¸¸',
                'stage_1': 'IæœŸå‹ç–®',
                'stage-1': 'IæœŸå‹ç–®',
                'stage_2': 'IIæœŸå‹ç–®',
                'stage-2': 'IIæœŸå‹ç–®',
                'stage_3': 'IIIæœŸå‹ç–®',
                'stage-3': 'IIIæœŸå‹ç–®',
                'stage_4': 'IVæœŸå‹ç–®',
                'stage-4': 'IVæœŸå‹ç–®',
                'dtpi': 'æ·±éƒ¨ç»„ç»‡å‹ä¼¤',
                'unstageable': 'ä¸å¯åˆ†æœŸ',
                'invalid': 'æ— æ³•è¯„ä¼°',
                'low': 'çŠ¶æ€è‰¯å¥½',
                'medium': 'éœ€è¦å…³æ³¨',
                'high': 'éœ€è¦å¤„ç†'
            };
            return stageMap[stage] || stage || 'æœªåˆ†æœŸ';
        }

        // æ›´æ–°å¾…å®¡æ ¸åˆ—è¡¨
        function updatePendingList(pendingReviews) {
            const listContainer = document.getElementById('pendingList');
            
            if (!pendingReviews || pendingReviews.length === 0) {
                listContainer.innerHTML = '<div class="empty-data">æš‚æ— å¾…å®¡æ ¸è¯„ä¼°</div>';
                listContainer.classList.remove('auto-scroll');
                return;
            }

            const html = pendingReviews.map(review => {
                const riskClass = review.risk_level === 'é«˜é£é™©' ? 'high-risk' : 
                                review.risk_level === 'ä¸­é£é™©' ? 'medium-risk' : 'low-risk';
                const badgeClass = review.risk_level === 'é«˜é£é™©' ? 'badge-high' : 
                                  review.risk_level === 'ä¸­é£é™©' ? 'badge-medium' : 'badge-low';
                const date = new Date(review.assessment_date);
                const dateStr = `${date.getMonth() + 1}/${date.getDate()} ${date.getHours()}:${String(date.getMinutes()).padStart(2, '0')}`;
                
                // å°†è‹±æ–‡çŠ¶æ€è½¬æ¢ä¸ºä¸­æ–‡
                const stageText = getStageTextChinese(review.pressure_stage);

                return `
                    <div class="list-item ${riskClass}">
                        <div class="list-item-header">
                            <span class="list-item-name">${review.patient_name}</span>
                            <span class="list-item-badge ${badgeClass}">${stageText}</span>
                        </div>
                        <div class="list-item-info">
                            è¯„åˆ†: ${review.score} | ${dateStr}
                        </div>
                    </div>
                `;
            }).join('');

            // å¦‚æœæ•°æ®è¶…è¿‡3æ¡ï¼Œå¯ç”¨è‡ªåŠ¨æ»šåŠ¨
            if (pendingReviews.length >= 3) {
                listContainer.classList.add('auto-scroll');
                // å¤åˆ¶å†…å®¹å®ç°æ— é™å¾ªç¯æ»šåŠ¨
                listContainer.innerHTML = `<div class="scroll-content">${html}${html}</div>`;
            } else {
                listContainer.classList.remove('auto-scroll');
                listContainer.innerHTML = html;
            }
        }

        // æ›´æ–°æ—¶é—´æ˜¾ç¤º
        function updateTimeDisplay() {
            const now = new Date();
            const timeStr = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')} ${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}:${String(now.getSeconds()).padStart(2, '0')}`;
            document.getElementById('updateTime').textContent = `æœ€åæ›´æ–°: ${timeStr}`;
        }

        // åŠ è½½æ‰€æœ‰æ•°æ®
        async function loadDashboardData() {
            try {
                const result = await fetchAPI('/dashboard/stats');
                
                if (result.success && result.data) {
                    const data = result.data;

                    // æ›´æ–°å„ä¸ªéƒ¨åˆ†
                    updateCoreStats(data);
                    updateRiskChart(data.riskDistribution || []);
                    updateTrendChart(data.assessmentTrend || []);
                    updateStageChart(data.stageDistribution || []);
                    updateStomaTypeChart(data.stomaTypeDistribution || []);
                    updateHighRiskList(data.highRiskPatients || []);
                    updatePendingList(data.pendingReviews || []);

                    // æ›´æ–°ä»Šæ—¥æ•°æ®
                    await updateTodayData();

                    // æ›´æ–°æ—¶é—´
                    updateTimeDisplay();
                }
            } catch (error) {
                console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
                showError('æ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œåç«¯æœåŠ¡');
            }
        }

        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        function showError(message) {
            const dashboardBody = document.getElementById('dashboardBody');
            dashboardBody.innerHTML = `
                <div class="error-message">
                    âŒ ${message}
                    <br><br>
                    <a href="login.html" style="color: #fff; text-decoration: underline;">è¿”å›ç™»å½•é¡µé¢</a>
                </div>
            `;
        }

        // åˆå§‹åŒ–
        async function init() {
            // æ¸…é™¤æ¥è‡ª login çš„æ ‡è®°
            sessionStorage.removeItem('toIndex');
            
            // æ£€æŸ¥token
            if (!CONFIG.token) {
                console.log('æœªæ£€æµ‹åˆ°ç™»å½•tokenï¼Œè·³è½¬åˆ°ç™»å½•é¡µé¢...');
                // è®¾ç½®æ ‡è®°ï¼Œè¡¨ç¤ºæ˜¯ä» index è·³è½¬åˆ° login
                sessionStorage.setItem('fromIndex', 'true');
                window.location.href = 'login.html';
                return;
            }

            // åˆ›å»ºç²’å­èƒŒæ™¯
            createParticles();

            // åˆå§‹åŒ–å›¾è¡¨
            initCharts();

            // åŠ è½½æ•°æ®
            await loadDashboardData();

            // å®šæ—¶åˆ·æ–°
            setInterval(loadDashboardData, CONFIG.refreshInterval);
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', init);

        // æ‰‹åŠ¨åˆ·æ–°ï¼ˆæŒ‰F5æˆ–ç‚¹å‡»åˆ·æ–°æŒ‰é’®ï¼‰
        window.addEventListener('keydown', (e) => {
            if (e.key === 'F5') {
                e.preventDefault();
                loadDashboardData();
            }
        });

        // é€€å‡ºç™»å½•
        function logout() {
            if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                // æ¸…é™¤tokenå’Œç”¨æˆ·ä¿¡æ¯
                localStorage.removeItem('token');
                localStorage.removeItem('userInfo');
                // è®¾ç½®æ ‡è®°ï¼Œè¡¨ç¤ºæ˜¯ä» index ä¸»åŠ¨é€€å‡º
                sessionStorage.setItem('fromIndex', 'true');
                console.log('å·²é€€å‡ºç™»å½•ï¼Œè·³è½¬åˆ°ç™»å½•é¡µé¢...');
                // è·³è½¬åˆ°ç™»å½•é¡µé¢
                window.location.href = 'login.html';
            }
        }
    </script>
</body>
</html>


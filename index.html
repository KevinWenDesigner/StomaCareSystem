<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÊÇ£ËÄÖÁÆ°ÁêÜÊï∞ÊçÆÂ§ßÂ±è - ÈÄ†Âè£Êä§ÁêÜÊô∫ËÉΩÁÆ°ÁêÜÁ≥ªÁªü</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <!-- ÈÖçÁΩÆÊñá‰ª∂ÔºöÂºÄÂèëÁéØÂ¢ÉÁî®config.dev.jsÔºåÁîü‰∫ßÁéØÂ¢ÉÁî®config.prod.js -->
    <script src="config.prod.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', 'PingFang SC', Arial, sans-serif;
            background: #0a1628;
            color: #fff;
            overflow: hidden;
            height: 100vh;
            position: relative;
        }

        /* Âä®ÊÄÅËÉåÊôØ */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 30%, rgba(59, 130, 246, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(96, 165, 250, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(147, 197, 253, 0.1) 0%, transparent 70%);
            animation: backgroundPulse 15s ease-in-out infinite;
            z-index: 0;
        }

        @keyframes backgroundPulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        /* Á≤íÂ≠êÊïàÊûúÂÆπÂô® */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 1;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 50%;
            animation: float linear infinite;
        }

        @keyframes float {
            0% {
                transform: translateY(100vh) scale(0);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) scale(1);
                opacity: 0;
            }
        }

        .dashboard-container {
            width: 100%;
            height: 100vh;
            padding: 1vh 1vw;
            display: flex;
            flex-direction: column;
            position: relative;
            z-index: 10;
        }

        /* Â§¥ÈÉ® */
        .dashboard-header {
            text-align: center;
            margin-bottom: 1vh;
            padding: 1vh 2vw;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.15), rgba(96, 165, 250, 0.1));
            backdrop-filter: blur(20px);
            border-radius: 15px;
            border: 1px solid rgba(96, 165, 250, 0.3);
            box-shadow: 
                0 8px 32px rgba(59, 130, 246, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
            animation: headerGlow 3s ease-in-out infinite;
        }

        @keyframes headerGlow {
            0%, 100% {
                box-shadow: 
                    0 8px 32px rgba(59, 130, 246, 0.2),
                    inset 0 1px 0 rgba(255, 255, 255, 0.1);
            }
            50% {
                box-shadow: 
                    0 8px 40px rgba(59, 130, 246, 0.4),
                    inset 0 1px 0 rgba(255, 255, 255, 0.2);
            }
        }

        .dashboard-header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.05), transparent);
            animation: headerShine 3s linear infinite;
        }

        @keyframes headerShine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .dashboard-header h1 {
            font-size: clamp(1.3rem, 2.5vw, 2rem);
            font-weight: 700;
            text-shadow: 
                0 0 10px rgba(59, 130, 246, 0.8),
                0 0 20px rgba(96, 165, 250, 0.6),
                2px 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 0.3vh;
            position: relative;
            z-index: 1;
            background: linear-gradient(135deg, #fff, #60a5fa, #fff);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 3s ease-in-out infinite;
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .dashboard-header .subtitle {
            font-size: clamp(0.75rem, 1.3vw, 1rem);
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .dashboard-header .update-time {
            font-size: clamp(0.65rem, 1.1vw, 0.85rem);
            opacity: 0.7;
            position: absolute;
            top: 50%;
            right: 30px;
            transform: translateY(-50%);
            z-index: 1;
            color: #60a5fa;
            animation: blink 2s ease-in-out infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }

        /* ‰∏ª‰ΩìÂÜÖÂÆπ */
        .dashboard-body {
            flex: 1;
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 1vw;
            min-height: 0;
            overflow: hidden;
        }

        /* Â∑¶‰æßÊ†è */
        .left-column {
            display: flex;
            flex-direction: column;
            gap: 1vh;
            min-height: 0;
        }

        /* ‰∏≠Èó¥Ê†è */
        .middle-column {
            display: flex;
            flex-direction: column;
            gap: 1vh;
            min-height: 0;
        }

        /* Âè≥‰æßÊ†è */
        .right-column {
            display: flex;
            flex-direction: column;
            gap: 1vh;
            min-height: 0;
        }

        /* Âç°ÁâáÊ†∑Âºè */
        .card {
            background: linear-gradient(135deg, rgba(30, 64, 175, 0.15), rgba(37, 99, 235, 0.08));
            backdrop-filter: blur(20px);
            border-radius: 15px;
            padding: 1vh 1vw;
            border: 1px solid rgba(96, 165, 250, 0.2);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.1), transparent);
            transition: left 0.6s;
        }

        .card:hover::before {
            left: 100%;
        }

        .card:hover {
            border-color: rgba(96, 165, 250, 0.5);
            box-shadow: 
                0 12px 40px rgba(59, 130, 246, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .card-title {
            font-size: clamp(1rem, 1.8vw, 1.3rem);
            font-weight: 600;
            margin-bottom: 0.8vh;
            padding-bottom: 0.5vh;
            border-bottom: 2px solid rgba(96, 165, 250, 0.3);
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
            flex-shrink: 0;
        }

        .card-title::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 60px;
            height: 2px;
            background: linear-gradient(90deg, #3b82f6, #60a5fa);
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.8);
            animation: titleGlow 2s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% {
                box-shadow: 0 0 10px rgba(59, 130, 246, 0.8);
                width: 60px;
            }
            50% {
                box-shadow: 0 0 20px rgba(59, 130, 246, 1);
                width: 80px;
            }
        }

        .card-title .icon {
            font-size: clamp(1.2rem, 2vw, 1.5rem);
            filter: drop-shadow(0 0 5px rgba(96, 165, 250, 0.8));
            animation: iconPulse 2s ease-in-out infinite;
        }

        @keyframes iconPulse {
            0%, 100% {
                transform: scale(1);
                filter: drop-shadow(0 0 5px rgba(96, 165, 250, 0.8));
            }
            50% {
                transform: scale(1.1);
                filter: drop-shadow(0 0 10px rgba(96, 165, 250, 1));
            }
        }

        /* ÁªüËÆ°Âç°ÁâáÁΩëÊ†º */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.8vw;
            flex-shrink: 0;
        }

        .stat-item {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(37, 99, 235, 0.1));
            padding: 1vh 0.8vw;
            border-radius: 12px;
            text-align: center;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(96, 165, 250, 0.2);
            position: relative;
            overflow: hidden;
        }

        .stat-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, rgba(59, 130, 246, 0.3), transparent 70%);
            opacity: 0;
            transition: opacity 0.4s;
        }

        .stat-item:hover::before {
            opacity: 1;
        }

        .stat-item:hover {
            transform: translateY(-5px) scale(1.02);
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.3), rgba(37, 99, 235, 0.15));
            border-color: rgba(96, 165, 250, 0.5);
            box-shadow: 
                0 10px 30px rgba(59, 130, 246, 0.4),
                inset 0 0 20px rgba(59, 130, 246, 0.1);
        }

        .stat-value {
            font-size: clamp(1.8rem, 3.5vw, 2.8rem);
            font-weight: 700;
            margin-bottom: 0.5vh;
            background: linear-gradient(135deg, #fff, #60a5fa, #93c5fd);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: numberGlow 3s ease-in-out infinite;
            text-shadow: 0 0 30px rgba(59, 130, 246, 0.5);
            position: relative;
            z-index: 1;
            filter: drop-shadow(0 0 10px rgba(96, 165, 250, 0.8));
        }

        @keyframes numberGlow {
            0%, 100% {
                background-position: 0% 50%;
                filter: drop-shadow(0 0 10px rgba(96, 165, 250, 0.8));
            }
            50% {
                background-position: 100% 50%;
                filter: drop-shadow(0 0 20px rgba(59, 130, 246, 1));
            }
        }

        .stat-label {
            font-size: clamp(0.75rem, 1.2vw, 0.9rem);
            opacity: 0.9;
            position: relative;
            z-index: 1;
            color: #e0f2fe;
        }

        .stat-change {
            font-size: clamp(0.7rem, 1vw, 0.8rem);
            margin-top: 0.5vh;
            opacity: 0.8;
            position: relative;
            z-index: 1;
        }

        .stat-change.positive {
            color: #4ade80;
            text-shadow: 0 0 5px rgba(74, 222, 128, 0.5);
        }

        .stat-change.negative {
            color: #f87171;
            text-shadow: 0 0 5px rgba(248, 113, 113, 0.5);
        }

        /* ÂõæË°®ÂÆπÂô® */
        .chart-container {
            flex: 1;
            margin-top: 0.5vh;
            min-height: 220px;
            max-height: 35vh;
        }

        .chart-container-large {
            flex: 1;
            margin-top: 0.5vh;
            min-height: 300px;
            max-height: 48vh;
        }

        /* ÂàóË°®Ê†∑Âºè */
        .data-list {
            flex: 1;
            overflow-y: auto;
            min-height: 150px;
        }

        /* Ëá™Âä®ÊªöÂä®ÂàóË°®Ê†∑Âºè */
        .data-list.auto-scroll {
            overflow: hidden;
            position: relative;
            mask-image: linear-gradient(to bottom, 
                transparent 0%, 
                black 5%, 
                black 95%, 
                transparent 100%);
            -webkit-mask-image: linear-gradient(to bottom, 
                transparent 0%, 
                black 5%, 
                black 95%, 
                transparent 100%);
        }

        .data-list.auto-scroll .scroll-content {
            animation: autoScroll 30s linear infinite;
            will-change: transform;
        }

        .data-list.auto-scroll:hover .scroll-content {
            animation-play-state: paused;
        }

        @keyframes autoScroll {
            0% {
                transform: translateY(0);
            }
            100% {
                transform: translateY(-50%);
            }
        }

        .data-list::-webkit-scrollbar {
            width: 8px;
        }

        .data-list::-webkit-scrollbar-track {
            background: rgba(59, 130, 246, 0.1);
            border-radius: 4px;
        }

        .data-list::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, rgba(59, 130, 246, 0.5), rgba(96, 165, 250, 0.5));
            border-radius: 4px;
            box-shadow: 0 0 6px rgba(59, 130, 246, 0.5);
        }

        .data-list::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, rgba(59, 130, 246, 0.7), rgba(96, 165, 250, 0.7));
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.8);
        }

        .list-item {
            padding: 0.8vh 0.8vw;
            margin-bottom: 0.8vh;
            background: linear-gradient(135deg, rgba(30, 64, 175, 0.2), rgba(37, 99, 235, 0.1));
            border-radius: 10px;
            border-left: 3px solid transparent;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .list-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.2), transparent);
            transition: left 0.5s;
        }

        .list-item:hover::before {
            left: 100%;
        }

        .list-item:hover {
            background: linear-gradient(135deg, rgba(30, 64, 175, 0.3), rgba(37, 99, 235, 0.15));
            transform: translateX(8px) scale(1.02);
            box-shadow: 
                -4px 0 15px rgba(59, 130, 246, 0.3),
                0 4px 20px rgba(0, 0, 0, 0.2);
        }

        .list-item.high-risk {
            border-left-color: #ef4444;
        }

        .list-item.high-risk:hover {
            box-shadow: 
                -4px 0 15px rgba(239, 68, 68, 0.5),
                0 4px 20px rgba(0, 0, 0, 0.2);
        }

        .list-item.medium-risk {
            border-left-color: #f59e0b;
        }

        .list-item.medium-risk:hover {
            box-shadow: 
                -4px 0 15px rgba(245, 158, 11, 0.5),
                0 4px 20px rgba(0, 0, 0, 0.2);
        }

        .list-item.low-risk {
            border-left-color: #10b981;
        }

        .list-item.low-risk:hover {
            box-shadow: 
                -4px 0 15px rgba(16, 185, 129, 0.5),
                0 4px 20px rgba(0, 0, 0, 0.2);
        }

        .list-item-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.3vh;
            position: relative;
            z-index: 1;
            align-items: center;
        }

        .list-item-name {
            font-weight: 600;
            font-size: clamp(0.8rem, 1.2vw, 0.95rem);
            color: #e0f2fe;
        }

        .list-item-badge {
            padding: 0.2vh 0.6vw;
            border-radius: 10px;
            font-size: clamp(0.65rem, 1vw, 0.75rem);
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            animation: badgePulse 2s ease-in-out infinite;
            white-space: nowrap;
        }

        @keyframes badgePulse {
            0%, 100% {
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            }
            50% {
                box-shadow: 0 2px 12px rgba(0, 0, 0, 0.5), 0 0 15px currentColor;
            }
        }

        .badge-high {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            box-shadow: 0 2px 8px rgba(239, 68, 68, 0.4);
        }

        .badge-medium {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            box-shadow: 0 2px 8px rgba(245, 158, 11, 0.4);
        }

        .badge-low {
            background: linear-gradient(135deg, #10b981, #059669);
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.4);
        }

        .list-item-info {
            font-size: clamp(0.7rem, 1vw, 0.8rem);
            opacity: 0.9;
            margin-top: 0.3vh;
            position: relative;
            z-index: 1;
            color: #bfdbfe;
            line-height: 1.4;
        }

        /* Âä†ËΩΩÂä®Áîª */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 20vh;
            font-size: clamp(1rem, 1.5vw, 1.2rem);
            position: relative;
        }

        .loading::before {
            content: '';
            width: 50px;
            height: 50px;
            border: 3px solid rgba(59, 130, 246, 0.2);
            border-top-color: #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 15px;
        }

        .loading::after {
            content: 'Âä†ËΩΩ‰∏≠...';
            animation: loadingPulse 1.5s ease-in-out infinite;
            color: #60a5fa;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes loadingPulse {
            0%, 100% { 
                opacity: 0.5; 
                text-shadow: 0 0 5px rgba(59, 130, 246, 0.3);
            }
            50% { 
                opacity: 1; 
                text-shadow: 0 0 15px rgba(59, 130, 246, 0.8);
            }
        }

        /* Á©∫Êï∞ÊçÆÊèêÁ§∫ */
        .empty-data {
            text-align: center;
            padding: 4vh 2vw;
            opacity: 0.6;
            font-size: clamp(0.85rem, 1.3vw, 0.95rem);
            color: #93c5fd;
            animation: fadeInOut 2s ease-in-out infinite;
        }

        @keyframes fadeInOut {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 0.8; }
        }

        /* ÂìçÂ∫îÂºè */
        @media (min-width: 1920px) {
            .dashboard-container {
                padding: 1.2vh 1.5vw;
            }
            
            .chart-container {
                min-height: 280px;
            }

            .chart-container-large {
                min-height: 380px;
            }
        }

        @media (max-width: 1600px) {
            .dashboard-body {
                grid-template-columns: 1fr 1.5fr 1fr;
            }
            
            .dashboard-header h1 {
                font-size: 1.8rem;
            }
        }

        @media (max-width: 1200px) {
            .dashboard-body {
                grid-template-columns: 1fr;
                overflow-y: auto;
                gap: 15px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(4, 1fr);
            }

            .card {
                padding: 15px;
            }

            .chart-container {
                height: 250px;
                max-height: none;
            }

            .chart-container-large {
                height: 300px;
                max-height: none;
            }
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .dashboard-header h1 {
                font-size: 1.5rem;
            }
        }

        /* Êï∞ÊçÆÂä®Áîª */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .card {
            animation: fadeIn 0.6s ease-out backwards;
        }

        .left-column .card:nth-child(1) { animation-delay: 0.1s; }
        .left-column .card:nth-child(2) { animation-delay: 0.2s; }
        .left-column .card:nth-child(3) { animation-delay: 0.3s; }
        .middle-column .card:nth-child(1) { animation-delay: 0.2s; }
        .middle-column .card:nth-child(2) { animation-delay: 0.3s; }
        .right-column .card:nth-child(1) { animation-delay: 0.3s; }
        .right-column .card:nth-child(2) { animation-delay: 0.4s; }
        .right-column .card:nth-child(3) { animation-delay: 0.5s; }

        /* ÊèêÁ§∫Ê°Ü */
        .tooltip {
            position: fixed;
            background: linear-gradient(135deg, rgba(30, 64, 175, 0.95), rgba(37, 99, 235, 0.95));
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.9rem;
            pointer-events: none;
            z-index: 1000;
            display: none;
            border: 1px solid rgba(96, 165, 250, 0.3);
            box-shadow: 0 4px 20px rgba(59, 130, 246, 0.4);
        }

        /* ÈîôËØØÊèêÁ§∫ */
        .error-message {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(220, 38, 38, 0.1));
            border: 1px solid rgba(239, 68, 68, 0.5);
            color: #fca5a5;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            margin: 20px;
            box-shadow: 0 4px 20px rgba(239, 68, 68, 0.3);
            animation: fadeIn 0.5s ease-out;
        }

        /* Êï∞ÊçÆÂà∑Êñ∞Âä®Áîª */
        .data-refresh {
            animation: dataRefresh 0.5s ease-out;
        }

        @keyframes dataRefresh {
            0% {
                opacity: 0.5;
                transform: scale(0.98);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }
    </style>
</head>
<body>
    <!-- Á≤íÂ≠êËÉåÊôØ -->
    <div class="particles" id="particles"></div>

    <div class="dashboard-container">
        <!-- Â§¥ÈÉ® -->
        <div class="dashboard-header">
            <h1>üè• ÊÇ£ËÄÖÁÆ°ÁêÜÊï∞ÊçÆÂ§ßÂ±è</h1>
            <div class="subtitle">ÈÄ†Âè£Êä§ÁêÜÊô∫ËÉΩÁÆ°ÁêÜÁ≥ªÁªü - ÂÆûÊó∂Êï∞ÊçÆÁõëÊéß</div>
            <div class="update-time" id="updateTime">ÊúÄÂêéÊõ¥Êñ∞: --</div>
        </div>

        <!-- ‰∏ª‰Ωì -->
        <div class="dashboard-body" id="dashboardBody">
            <!-- Â∑¶‰æßÊ†è -->
            <div class="left-column">
                <!-- Ê†∏ÂøÉÁªüËÆ° -->
                <div class="card">
                    <div class="card-title">
                        <span class="icon">üìä</span>
                        <span>Ê†∏ÂøÉÊåáÊ†á</span>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value" id="totalPatients">0</div>
                            <div class="stat-label">ÊÄªÊÇ£ËÄÖÊï∞</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="activePatients">0</div>
                            <div class="stat-label">Ê¥ªË∑ÉÊÇ£ËÄÖ</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="totalAssessments">0</div>
                            <div class="stat-label">ÊÄªËØÑ‰º∞Ê¨°Êï∞</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="pendingReviews">0</div>
                            <div class="stat-label">ÂæÖÂÆ°Ê†∏</div>
                        </div>
                    </div>
                </div>

                <!-- ‰ªäÊó•Êï∞ÊçÆ -->
                <div class="card">
                    <div class="card-title">
                        <span class="icon">üìÖ</span>
                        <span>‰ªäÊó•Êï∞ÊçÆ</span>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value" id="todayAssessments">0</div>
                            <div class="stat-label">‰ªäÊó•ËØÑ‰º∞</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="todayDiaries">0</div>
                            <div class="stat-label">‰ªäÊó•Êó•ËÆ∞</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="weekAssessments">0</div>
                            <div class="stat-label">Êú¨Âë®ËØÑ‰º∞</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="avgScore">0</div>
                            <div class="stat-label">Âπ≥ÂùáDETÂàÜ</div>
                        </div>
                    </div>
                </div>

                <!-- DETÁ≠âÁ∫ßÂàÜÂ∏É -->
                <div class="card" style="flex: 1;">
                    <div class="card-title">
                        <span class="icon">‚ö†Ô∏è</span>
                        <span>DETÁ≠âÁ∫ßÂàÜÂ∏É</span>
                    </div>
                    <div class="chart-container" id="riskChart"></div>
                </div>
            </div>

            <!-- ‰∏≠Èó¥Ê†è -->
            <div class="middle-column">
                <!-- ËØÑ‰º∞Ë∂ãÂäø -->
                <div class="card" style="flex: 1;">
                    <div class="card-title">
                        <span class="icon">üìà</span>
                        <span>ËØÑ‰º∞Ë∂ãÂäøÂàÜÊûêÔºàËøë7Â§©Ôºâ</span>
                    </div>
                    <div class="chart-container-large" id="trendChart"></div>
                </div>

                <!-- DETÁª¥Â∫¶ÂàÜÊûê -->
                <div class="card" style="flex: 1;">
                    <div class="card-title">
                        <span class="icon">üìã</span>
                        <span>DETÁª¥Â∫¶ÂàÜÊûêÔºàÂπ≥ÂùáÂàÜÔºâ</span>
                    </div>
                    <div class="chart-container" id="stageChart"></div>
                </div>
            </div>

            <!-- Âè≥‰æßÊ†è -->
            <div class="right-column">
                <!-- ÈÄ†Âè£Á±ªÂûãÂàÜÂ∏É -->
                <div class="card">
                    <div class="card-title">
                        <span class="icon">üîç</span>
                        <span>ÈÄ†Âè£Á±ªÂûã</span>
                    </div>
                    <div class="chart-container" id="stomaTypeChart"></div>
                </div>

                <!-- ÈáçÁÇπÂÖ≥Ê≥®ÊÇ£ËÄÖ -->
                <div class="card" style="flex: 1;">
                    <div class="card-title">
                        <span class="icon">üö®</span>
                        <span>ÈáçÁÇπÂÖ≥Ê≥®ÊÇ£ËÄÖ</span>
                    </div>
                    <div class="data-list" id="highRiskList"></div>
                </div>

                <!-- ÂæÖÂÆ°Ê†∏ËØÑ‰º∞ -->
                <div class="card" style="flex: 1;">
                    <div class="card-title">
                        <span class="icon">‚è∞</span>
                        <span>ÂæÖÂÆ°Ê†∏ËØÑ‰º∞</span>
                    </div>
                    <div class="data-list" id="pendingList"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ÈÖçÁΩÆ - ‰ºòÂÖà‰ΩøÁî®Â§ñÈÉ®ÈÖçÁΩÆÔºåÁÑ∂ÂêéÊòØlocalStorageÔºåÊúÄÂêéÊòØÈªòËÆ§ÂÄº
        const CONFIG = {
            apiBaseUrl: (window.DASHBOARD_CONFIG && window.DASHBOARD_CONFIG.apiBaseUrl) || 
                        localStorage.getItem('apiBaseUrl') || 
                        'http://localhost:3000/api',
            refreshInterval: (window.DASHBOARD_CONFIG && window.DASHBOARD_CONFIG.refreshInterval) || 30000,
            token: localStorage.getItem('token') || ''
        };

        // ÂàõÂª∫Á≤íÂ≠êËÉåÊôØ
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = 30;

            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                // ÈöèÊú∫Â§ßÂ∞è
                const size = Math.random() * 4 + 2;
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                
                // ÈöèÊú∫‰ΩçÁΩÆ
                particle.style.left = `${Math.random() * 100}%`;
                
                // ÈöèÊú∫Âä®ÁîªÊó∂Èïø
                const duration = Math.random() * 20 + 15;
                particle.style.animationDuration = `${duration}s`;
                
                // ÈöèÊú∫Âª∂Ëøü
                const delay = Math.random() * 10;
                particle.style.animationDelay = `${delay}s`;
                
                particlesContainer.appendChild(particle);
            }
        }

        // Êï∞Â≠óÊªöÂä®Âä®Áîª
        function animateNumber(element, target, duration = 1000) {
            const start = parseInt(element.textContent) || 0;
            
            // Â¶ÇÊûúÁõÆÊ†áÂÄº‰∏éÂΩìÂâçÂÄºÁõ∏ÂêåÔºå‰∏çÊâßË°åÂä®Áîª
            if (start === target) {
                return;
            }
            
            const increment = (target - start) / (duration / 16);
            let current = start;
            
            // Ê∏ÖÈô§ÂèØËÉΩÂ≠òÂú®ÁöÑÊóßÂÆöÊó∂Âô®
            if (element.animationTimer) {
                clearInterval(element.animationTimer);
            }
            
            element.animationTimer = setInterval(() => {
                current += increment;
                if ((increment > 0 && current >= target) || (increment < 0 && current <= target)) {
                    element.textContent = target;
                    clearInterval(element.animationTimer);
                    element.animationTimer = null;
                } else {
                    element.textContent = Math.round(current);
                }
            }, 16);
        }

        // Êï∞Â≠óÊªöÂä®Âä®ÁîªÔºàÊîØÊåÅÂ∞èÊï∞Ôºâ
        function animateNumberDecimal(element, target, duration = 1000, decimals = 1) {
            const start = parseFloat(element.textContent) || 0;
            
            // Â¶ÇÊûúÁõÆÊ†áÂÄº‰∏éÂΩìÂâçÂÄºÁõ∏ÂêåÔºàÂÖÅËÆ∏Â∞èËØØÂ∑ÆÔºâÔºå‰∏çÊâßË°åÂä®Áîª
            if (Math.abs(start - target) < 0.01) {
                element.textContent = target.toFixed(decimals);
                return;
            }
            
            const increment = (target - start) / (duration / 16);
            let current = start;
            
            // Ê∏ÖÈô§ÂèØËÉΩÂ≠òÂú®ÁöÑÊóßÂÆöÊó∂Âô®
            if (element.animationTimer) {
                clearInterval(element.animationTimer);
            }
            
            element.animationTimer = setInterval(() => {
                current += increment;
                if ((increment > 0 && current >= target) || (increment < 0 && current <= target)) {
                    element.textContent = target.toFixed(decimals);
                    clearInterval(element.animationTimer);
                    element.animationTimer = null;
                } else {
                    element.textContent = current.toFixed(decimals);
                }
            }, 16);
        }

        // APIËØ∑Ê±ÇÂ∞ÅË£Ö
        async function fetchAPI(endpoint) {
            try {
                const response = await fetch(`${CONFIG.apiBaseUrl}${endpoint}`, {
                    headers: {
                        'Authorization': `Bearer ${CONFIG.token}`,
                        'Content-Type': 'application/json'
                    }
                });

                // Â¶ÇÊûúÊòØ 401/403ÔºåËØ¥Êòé token Êó†Êïà
                if (response.status === 401 || response.status === 403) {
                    console.error('Token Êó†ÊïàÊàñÂ∑≤ËøáÊúüÔºåËØ∑ÈáçÊñ∞ÁôªÂΩï');
                    // Ê∏ÖÈô§ token
                    localStorage.removeItem('token');
                    localStorage.removeItem('userInfo');
                    // ËÆæÁΩÆÊ†áËÆ∞ÔºåË°®Á§∫ÊòØ‰ªé index Ë∑≥ËΩ¨Âà∞ login
                    sessionStorage.setItem('fromIndex', 'true');
                    // Ë∑≥ËΩ¨Âà∞ÁôªÂΩïÈ°µ
                    alert('ÁôªÂΩïÂ∑≤ËøáÊúüÔºåËØ∑ÈáçÊñ∞ÁôªÂΩï');
                    window.location.href = 'login.html';
                    return;
                }

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                return data;
            } catch (error) {
                console.error('APIËØ∑Ê±ÇÂ§±Ë¥•:', error);
                throw error;
            }
        }

        // ÂàùÂßãÂåñÂõæË°®
        const charts = {
            risk: null,
            trend: null,
            stage: null,
            stomaType: null
        };

        // ÂàùÂßãÂåñÊâÄÊúâÂõæË°®
        function initCharts() {
            charts.risk = echarts.init(document.getElementById('riskChart'));
            charts.trend = echarts.init(document.getElementById('trendChart'));
            charts.stage = echarts.init(document.getElementById('stageChart'));
            charts.stomaType = echarts.init(document.getElementById('stomaTypeChart'));

            // ÂìçÂ∫îÂºè
            window.addEventListener('resize', () => {
                Object.values(charts).forEach(chart => chart && chart.resize());
            });
        }

        // Êõ¥Êñ∞Ê†∏ÂøÉÁªüËÆ°Êï∞ÊçÆ
        function updateCoreStats(data) {
            const { patientStats, assessmentStats } = data;

            // ‰ΩøÁî®Âä®ÁîªÊõ¥Êñ∞Êï∞Â≠óÔºàÂè™ÊúâÊï∞ÂÄºÂèòÂåñÊó∂Êâç‰ºöÊúâÂä®ÁîªÊïàÊûúÔºâ
            animateNumber(document.getElementById('totalPatients'), patientStats.total_patients || 0);
            animateNumber(document.getElementById('activePatients'), patientStats.active_patients || 0);
            animateNumber(document.getElementById('totalAssessments'), assessmentStats.total_assessments || 0);
            animateNumber(document.getElementById('pendingReviews'), assessmentStats.pending_review || 0);

            animateNumber(document.getElementById('todayAssessments'), assessmentStats.today_assessments || 0);
            animateNumber(document.getElementById('weekAssessments'), assessmentStats.week_assessments || 0);
            // ÊòæÁ§∫Âπ≥ÂùáDETËØÑÂàÜÔºà0-15ÂàÜÔºâ
            animateNumberDecimal(document.getElementById('avgScore'), Number(assessmentStats.avg_score) || 0, 1000, 1);
        }

        // Êõ¥Êñ∞‰ªäÊó•Êï∞ÊçÆ
        async function updateTodayData() {
            try {
                const result = await fetchAPI('/dashboard/realtime');
                if (result.success && result.data) {
                    const { todayData } = result.data;
                    animateNumber(document.getElementById('todayDiaries'), todayData.today_diaries || 0);
                }
            } catch (error) {
                console.error('Ëé∑Âèñ‰ªäÊó•Êï∞ÊçÆÂ§±Ë¥•:', error);
            }
        }

        // Êõ¥Êñ∞DETÁ≠âÁ∫ßÂàÜÂ∏ÉÂõæË°®
        function updateRiskChart(riskDistribution) {
            if (!charts.risk) return;
            
            // DETÁ≠âÁ∫ßÊò†Â∞Ñ
            const riskMap = {
                'excellent': { value: 0, name: '‰ºòÁßÄÔºàÊó†ÁöÆÁÇéÔºâ', color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                    {offset: 0, color: '#10b981'},
                    {offset: 1, color: '#059669'}
                ])},
                'good': { value: 0, name: 'ËâØÂ•ΩÔºàËΩªÂ∫¶Ôºâ', color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                    {offset: 0, color: '#52c41a'},
                    {offset: 1, color: '#389e0d'}
                ])},
                'moderate': { value: 0, name: '‰∏≠Â∫¶ÔºàÈúÄÊ≥®ÊÑèÔºâ', color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                    {offset: 0, color: '#f59e0b'},
                    {offset: 1, color: '#d97706'}
                ])},
                'poor': { value: 0, name: 'ÈáçÂ∫¶ÔºàÈúÄÂ§ÑÁêÜÔºâ', color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                    {offset: 0, color: '#f97316'},
                    {offset: 1, color: '#ea580c'}
                ])},
                'critical': { value: 0, name: 'ÊûÅÈáçÂ∫¶ÔºàÁ¥ßÊÄ•Ôºâ', color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                    {offset: 0, color: '#ef4444'},
                    {offset: 1, color: '#dc2626'}
                ])}
            };

            riskDistribution.forEach(item => {
                if (riskMap[item.risk_level]) {
                    riskMap[item.risk_level].value = item.count;
                }
            });

            const option = {
                tooltip: {
                    trigger: 'item',
                    formatter: '{b}: {c} ({d}%)',
                    backgroundColor: 'rgba(30, 64, 175, 0.95)',
                    borderColor: 'rgba(96, 165, 250, 0.5)',
                    textStyle: {
                        color: '#fff'
                    }
                },
                legend: {
                    orient: 'horizontal',
                    bottom: 5,
                    left: 'center',
                    itemGap: 12,
                    itemWidth: 12,
                    itemHeight: 12,
                    textStyle: {
                        color: '#e0f2fe',
                        fontSize: 9
                    }
                },
                series: [{
                    type: 'pie',
                    radius: ['35%', '60%'],
                    center: ['50%', '42%'],
                    data: [
                        { value: riskMap['excellent'].value, name: riskMap['excellent'].name, itemStyle: { color: riskMap['excellent'].color } },
                        { value: riskMap['good'].value, name: riskMap['good'].name, itemStyle: { color: riskMap['good'].color } },
                        { value: riskMap['moderate'].value, name: riskMap['moderate'].name, itemStyle: { color: riskMap['moderate'].color } },
                        { value: riskMap['poor'].value, name: riskMap['poor'].name, itemStyle: { color: riskMap['poor'].color } },
                        { value: riskMap['critical'].value, name: riskMap['critical'].name, itemStyle: { color: riskMap['critical'].color } }
                    ],
                    emphasis: {
                        itemStyle: {
                            shadowBlur: 20,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(59, 130, 246, 0.8)'
                        },
                        scale: true,
                        scaleSize: 10
                    },
                    label: {
                        color: '#fff',
                        fontSize: 12,
                        formatter: '{b}\n{d}%'
                    },
                    labelLine: {
                        lineStyle: {
                            color: 'rgba(255, 255, 255, 0.5)'
                        }
                    },
                    animationType: 'scale',
                    animationEasing: 'elasticOut',
                    animationDelay: function (idx) {
                        return idx * 200;
                    }
                }]
            };

            // ‰ΩøÁî® notMerge: false Êù•Êõ¥Êñ∞ËÄå‰∏çÊòØÂÆåÂÖ®ÊõøÊç¢ÔºåÂáèÂ∞ëÈó™ÁÉÅ
            charts.risk.setOption(option, { notMerge: false, lazyUpdate: true });
        }

        // Êõ¥Êñ∞ËØÑ‰º∞Ë∂ãÂäøÂõæË°®
        function updateTrendChart(assessmentTrend) {
            if (!charts.trend) return;
            
            const dates = assessmentTrend.map(item => {
                const date = new Date(item.date);
                return `${date.getMonth() + 1}/${date.getDate()}`;
            });
            const counts = assessmentTrend.map(item => item.count);
            // DETËØÑÂàÜËåÉÂõ¥0-15ÂàÜ
            const scores = assessmentTrend.map(item => (Number(item.avg_score) || 0).toFixed(1));

            const option = {
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'cross',
                        crossStyle: {
                            color: 'rgba(96, 165, 250, 0.5)'
                        },
                        lineStyle: {
                            color: 'rgba(96, 165, 250, 0.5)'
                        }
                    },
                    backgroundColor: 'rgba(30, 64, 175, 0.95)',
                    borderColor: 'rgba(96, 165, 250, 0.5)',
                    textStyle: {
                        color: '#fff'
                    }
                },
                legend: {
                    data: ['ËØÑ‰º∞Ê¨°Êï∞', 'DETÂπ≥ÂùáÂàÜ'],
                    textStyle: {
                        color: '#e0f2fe',
                        fontSize: 12
                    },
                    top: 0
                },
                grid: {
                    left: '5%',
                    right: '5%',
                    bottom: '8%',
                    top: '12%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    boundaryGap: false,
                    data: dates,
                    axisLine: {
                        lineStyle: {
                            color: 'rgba(96, 165, 250, 0.5)',
                            width: 2
                        }
                    },
                    axisLabel: {
                        color: '#e0f2fe',
                        fontSize: 11
                    },
                    axisTick: {
                        lineStyle: {
                            color: 'rgba(96, 165, 250, 0.3)'
                        }
                    }
                },
                yAxis: [
                    {
                        type: 'value',
                        name: 'ËØÑ‰º∞Ê¨°Êï∞',
                        position: 'left',
                        nameTextStyle: {
                            color: '#4ade80',
                            fontSize: 12
                        },
                        axisLine: {
                            lineStyle: {
                                color: 'rgba(74, 222, 128, 0.5)',
                                width: 2
                            }
                        },
                        axisLabel: {
                            color: '#e0f2fe',
                            fontSize: 11
                        },
                        splitLine: {
                            lineStyle: {
                                color: 'rgba(96, 165, 250, 0.1)',
                                type: 'dashed'
                            }
                        }
                    },
                    {
                        type: 'value',
                        name: 'DETÂπ≥ÂùáÂàÜ',
                        position: 'right',
                        max: 15,  // DETËØÑÂàÜËåÉÂõ¥0-15
                        nameTextStyle: {
                            color: '#60a5fa',
                            fontSize: 12
                        },
                        axisLine: {
                            lineStyle: {
                                color: 'rgba(96, 165, 250, 0.5)',
                                width: 2
                            }
                        },
                        axisLabel: {
                            color: '#e0f2fe',
                            fontSize: 11
                        },
                        splitLine: {
                            show: false
                        }
                    }
                ],
                series: [
                    {
                        name: 'ËØÑ‰º∞Ê¨°Êï∞',
                        type: 'line',
                        smooth: true,
                        data: counts,
                        yAxisIndex: 0,
                        symbolSize: 8,
                        itemStyle: {
                            color: '#4ade80',
                            shadowBlur: 10,
                            shadowColor: 'rgba(74, 222, 128, 0.8)'
                        },
                        lineStyle: {
                            width: 3,
                            shadowBlur: 10,
                            shadowColor: 'rgba(74, 222, 128, 0.5)'
                        },
                        areaStyle: {
                            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                {offset: 0, color: 'rgba(74, 222, 128, 0.6)'},
                                {offset: 1, color: 'rgba(74, 222, 128, 0.05)'}
                            ]),
                            shadowBlur: 20,
                            shadowColor: 'rgba(74, 222, 128, 0.3)'
                        },
                        emphasis: {
                            focus: 'series',
                            itemStyle: {
                                shadowBlur: 20,
                                shadowColor: 'rgba(74, 222, 128, 1)'
                            }
                        },
                        animationDelay: function (idx) {
                            return idx * 50;
                        }
                    },
                    {
                        name: 'DETÂπ≥ÂùáÂàÜ',
                        type: 'line',
                        smooth: true,
                        data: scores,
                        yAxisIndex: 1,
                        symbolSize: 8,
                        itemStyle: {
                            color: '#60a5fa',
                            shadowBlur: 10,
                            shadowColor: 'rgba(96, 165, 250, 0.8)'
                        },
                        lineStyle: {
                            width: 3,
                            shadowBlur: 10,
                            shadowColor: 'rgba(96, 165, 250, 0.5)'
                        },
                        emphasis: {
                            focus: 'series',
                            itemStyle: {
                                shadowBlur: 20,
                                shadowColor: 'rgba(96, 165, 250, 1)'
                            }
                        },
                        animationDelay: function (idx) {
                            return idx * 50 + 300;
                        }
                    }
                ],
                animationEasing: 'elasticOut',
                animationDuration: 1000
            };

            charts.trend.setOption(option, { notMerge: false, lazyUpdate: true });
        }

        // Êõ¥Êñ∞DETÁª¥Â∫¶ÂàÜÊûêÂõæË°®
        function updateStageChart(stageDistribution) {
            if (!charts.stage) return;
            
            // DETÁª¥Â∫¶Â∑≤ÁªèÊòØ‰∏≠ÊñáÔºåÁõ¥Êé•‰ΩøÁî®
            const stages = stageDistribution.map(item => item.pressure_stage || 'Êú™Áü•');
            const counts = stageDistribution.map(item => Number(item.count) || 0);

            const option = {
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'shadow',
                        shadowStyle: {
                            color: 'rgba(59, 130, 246, 0.2)'
                        }
                    },
                    formatter: function(params) {
                        const param = params[0];
                        return `${param.name}<br/>Âπ≥ÂùáÂàÜ: ${param.value}/5`;
                    },
                    backgroundColor: 'rgba(30, 64, 175, 0.95)',
                    borderColor: 'rgba(96, 165, 250, 0.5)',
                    textStyle: {
                        color: '#fff'
                    }
                },
                grid: {
                    left: '5%',
                    right: '5%',
                    bottom: '12%',
                    top: '8%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: stages,
                    axisLine: {
                        lineStyle: {
                            color: 'rgba(96, 165, 250, 0.5)',
                            width: 2
                        }
                    },
                    axisLabel: {
                        color: '#e0f2fe',
                        rotate: 0,
                        fontSize: 12,
                        interval: 0
                    },
                    axisTick: {
                        lineStyle: {
                            color: 'rgba(96, 165, 250, 0.3)'
                        }
                    }
                },
                yAxis: {
                    type: 'value',
                    max: 5,  // DETÂêÑÁª¥Â∫¶ÊúÄÈ´ò5ÂàÜ
                    axisLine: {
                        lineStyle: {
                            color: 'rgba(96, 165, 250, 0.5)',
                            width: 2
                        }
                    },
                    axisLabel: {
                        color: '#e0f2fe',
                        fontSize: 11,
                        formatter: '{value}ÂàÜ'
                    },
                    splitLine: {
                        lineStyle: {
                            color: 'rgba(96, 165, 250, 0.1)',
                            type: 'dashed'
                        }
                    }
                },
                series: [{
                    type: 'bar',
                    data: counts,
                    barWidth: '50%',
                    itemStyle: {
                        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                            {offset: 0, color: '#60a5fa'},
                            {offset: 1, color: '#3b82f6'}
                        ]),
                        borderRadius: [8, 8, 0, 0],
                        shadowBlur: 10,
                        shadowColor: 'rgba(59, 130, 246, 0.5)'
                    },
                    emphasis: {
                        itemStyle: {
                            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                {offset: 0, color: '#93c5fd'},
                                {offset: 1, color: '#60a5fa'}
                            ]),
                            shadowBlur: 20,
                            shadowColor: 'rgba(59, 130, 246, 0.8)'
                        }
                    },
                    animationDelay: function (idx) {
                        return idx * 100;
                    }
                }],
                animationEasing: 'elasticOut',
                animationDuration: 800
            };

            charts.stage.setOption(option, { notMerge: false, lazyUpdate: true });
        }

        // Êõ¥Êñ∞ÈÄ†Âè£Á±ªÂûãÂõæË°®
        function updateStomaTypeChart(stomaTypeDistribution) {
            if (!charts.stomaType) return;
            
            // ÈÄ†Âè£Á±ªÂûã‰∏≠Ëã±ÊñáÊò†Â∞Ñ
            const stomaTypeMap = {
                'colostomy': 'ÁªìËÇ†ÈÄ†Âè£',
                'ileostomy': 'ÂõûËÇ†ÈÄ†Âè£',
                'urostomy': 'Ê≥åÂ∞øÈÄ†Âè£',
                'gastrostomy': 'ËÉÉÈÄ†Âè£',
                'jejunostomy': 'Á©∫ËÇ†ÈÄ†Âè£',
                'tracheostomy': 'Ê∞îÁÆ°ÈÄ†Âè£'
            };
            
            const types = stomaTypeDistribution.map(item => {
                const originalType = item.stoma_type || 'Êú™Áü•';
                return stomaTypeMap[originalType] || originalType;
            });
            const counts = stomaTypeDistribution.map(item => item.count);

            // ËìùÁôΩËâ≤Á≥ªÈÖçËâ≤
            const colors = [
                new echarts.graphic.LinearGradient(0, 0, 1, 1, [
                    {offset: 0, color: '#60a5fa'},
                    {offset: 1, color: '#3b82f6'}
                ]),
                new echarts.graphic.LinearGradient(0, 0, 1, 1, [
                    {offset: 0, color: '#93c5fd'},
                    {offset: 1, color: '#60a5fa'}
                ]),
                new echarts.graphic.LinearGradient(0, 0, 1, 1, [
                    {offset: 0, color: '#dbeafe'},
                    {offset: 1, color: '#93c5fd'}
                ]),
                new echarts.graphic.LinearGradient(0, 0, 1, 1, [
                    {offset: 0, color: '#3b82f6'},
                    {offset: 1, color: '#2563eb'}
                ])
            ];

            const option = {
                tooltip: {
                    trigger: 'item',
                    formatter: '{b}: {c} ({d}%)',
                    backgroundColor: 'rgba(30, 64, 175, 0.95)',
                    borderColor: 'rgba(96, 165, 250, 0.5)',
                    textStyle: {
                        color: '#fff'
                    }
                },
                legend: {
                    orient: 'vertical',
                    right: 10,
                    top: 'center',
                    textStyle: {
                        color: '#e0f2fe',
                        fontSize: 11
                    }
                },
                series: [{
                    type: 'pie',
                    radius: ['35%', '65%'],
                    center: ['40%', '50%'],
                    data: types.map((type, index) => ({
                        value: counts[index],
                        name: type,
                        itemStyle: {
                            color: colors[index % colors.length],
                            shadowBlur: 10,
                            shadowColor: 'rgba(59, 130, 246, 0.5)'
                        }
                    })),
                    emphasis: {
                        itemStyle: {
                            shadowBlur: 20,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(59, 130, 246, 0.8)'
                        },
                        scale: true,
                        scaleSize: 10
                    },
                    label: {
                        color: '#fff',
                        fontSize: 11,
                        formatter: '{b}\n{d}%'
                    },
                    labelLine: {
                        lineStyle: {
                            color: 'rgba(255, 255, 255, 0.5)'
                        }
                    },
                    animationType: 'scale',
                    animationEasing: 'elasticOut',
                    animationDelay: function (idx) {
                        return idx * 150;
                    }
                }]
            };

            charts.stomaType.setOption(option, { notMerge: false, lazyUpdate: true });
        }

        // Êõ¥Êñ∞ÈáçÁÇπÂÖ≥Ê≥®ÊÇ£ËÄÖÂàóË°®
        function updateHighRiskList(highRiskPatients) {
            const listContainer = document.getElementById('highRiskList');
            
            if (!highRiskPatients || highRiskPatients.length === 0) {
                listContainer.innerHTML = '<div class="empty-data">ÊöÇÊó†ÈáçÁÇπÂÖ≥Ê≥®ÊÇ£ËÄÖ</div>';
                listContainer.classList.remove('auto-scroll');
                return;
            }

            const html = highRiskPatients.map(patient => {
                // Ê†πÊçÆDETÁ≠âÁ∫ßÁ°ÆÂÆöÊ†∑Âºè
                const detLevel = patient.risk_level;
                const riskClass = detLevel === 'critical' || detLevel === 'poor' ? 'high-risk' : 
                                detLevel === 'moderate' ? 'medium-risk' : 'low-risk';
                const badgeClass = detLevel === 'critical' || detLevel === 'poor' ? 'badge-high' : 
                                  detLevel === 'moderate' ? 'badge-medium' : 'badge-low';
                
                // DETÁ≠âÁ∫ß‰∏≠ÊñáÊòæÁ§∫
                const detLevelText = getDetLevelTextChinese(detLevel);
                
                const date = new Date(patient.assessment_date);
                const dateStr = `${date.getMonth() + 1}/${date.getDate()} ${date.getHours()}:${String(date.getMinutes()).padStart(2, '0')}`;
                
                // ÊòæÁ§∫DETÊÄªÂàÜ
                const detTotal = patient.det_total || patient.score || 0;

                return `
                    <div class="list-item ${riskClass}">
                        <div class="list-item-header">
                            <span class="list-item-name">${patient.name}</span>
                            <span class="list-item-badge ${badgeClass}">${detLevelText}</span>
                        </div>
                        <div class="list-item-info">
                            DETËØÑÂàÜ: ${detTotal}/15ÂàÜ<br>
                            ${patient.stoma_type || 'Êú™Áü•Á±ªÂûã'} | ${dateStr}
                        </div>
                    </div>
                `;
            }).join('');

            // Â¶ÇÊûúÊï∞ÊçÆË∂ÖËøá3Êù°ÔºåÂêØÁî®Ëá™Âä®ÊªöÂä®
            if (highRiskPatients.length >= 3) {
                listContainer.classList.add('auto-scroll');
                // Â§çÂà∂ÂÜÖÂÆπÂÆûÁé∞Êó†ÈôêÂæ™ÁéØÊªöÂä®
                listContainer.innerHTML = `<div class="scroll-content">${html}${html}</div>`;
            } else {
                listContainer.classList.remove('auto-scroll');
                listContainer.innerHTML = html;
            }
        }

        // DETÁ≠âÁ∫ßÊò†Â∞ÑÔºàËã±ÊñáËΩ¨‰∏≠ÊñáÔºâ
        function getDetLevelTextChinese(detLevel) {
            const levelMap = {
                'excellent': '‰ºòÁßÄ',
                'good': 'ËâØÂ•Ω',
                'moderate': 'ÈúÄÊ≥®ÊÑè',
                'poor': 'ÈúÄÂ§ÑÁêÜ',
                'critical': 'Á¥ßÊÄ•'
            };
            return levelMap[detLevel] || detLevel || 'Êú™Áü•';
        }
        
        // ÊóßÂáΩÊï∞‰øùÁïôÁî®‰∫éÂÖºÂÆπ
        function getStageTextChinese(stage) {
            return getDetLevelTextChinese(stage);
        }

        // Êõ¥Êñ∞ÂæÖÂÆ°Ê†∏ÂàóË°®
        function updatePendingList(pendingReviews) {
            const listContainer = document.getElementById('pendingList');
            
            if (!pendingReviews || pendingReviews.length === 0) {
                listContainer.innerHTML = '<div class="empty-data">ÊöÇÊó†ÂæÖÂÆ°Ê†∏ËØÑ‰º∞</div>';
                listContainer.classList.remove('auto-scroll');
                return;
            }

            const html = pendingReviews.map(review => {
                // Ê†πÊçÆDETÁ≠âÁ∫ßÁ°ÆÂÆöÊ†∑Âºè
                const detLevel = review.risk_level;
                const riskClass = detLevel === 'critical' || detLevel === 'poor' ? 'high-risk' : 
                                detLevel === 'moderate' ? 'medium-risk' : 'low-risk';
                const badgeClass = detLevel === 'critical' || detLevel === 'poor' ? 'badge-high' : 
                                  detLevel === 'moderate' ? 'badge-medium' : 'badge-low';
                
                const date = new Date(review.assessment_date);
                const dateStr = `${date.getMonth() + 1}/${date.getDate()} ${date.getHours()}:${String(date.getMinutes()).padStart(2, '0')}`;
                
                // DETÁ≠âÁ∫ß‰∏≠ÊñáÊòæÁ§∫
                const detLevelText = getDetLevelTextChinese(detLevel);
                
                // ÊòæÁ§∫DETÊÄªÂàÜ
                const detTotal = review.det_total || review.score || 0;

                return `
                    <div class="list-item ${riskClass}">
                        <div class="list-item-header">
                            <span class="list-item-name">${review.patient_name}</span>
                            <span class="list-item-badge ${badgeClass}">${detLevelText}</span>
                        </div>
                        <div class="list-item-info">
                            DETËØÑÂàÜ: ${detTotal}/15ÂàÜ | ${dateStr}
                        </div>
                    </div>
                `;
            }).join('');

            // Â¶ÇÊûúÊï∞ÊçÆË∂ÖËøá3Êù°ÔºåÂêØÁî®Ëá™Âä®ÊªöÂä®
            if (pendingReviews.length >= 3) {
                listContainer.classList.add('auto-scroll');
                // Â§çÂà∂ÂÜÖÂÆπÂÆûÁé∞Êó†ÈôêÂæ™ÁéØÊªöÂä®
                listContainer.innerHTML = `<div class="scroll-content">${html}${html}</div>`;
            } else {
                listContainer.classList.remove('auto-scroll');
                listContainer.innerHTML = html;
            }
        }

        // Êõ¥Êñ∞Êó∂Èó¥ÊòæÁ§∫
        function updateTimeDisplay() {
            const now = new Date();
            const timeStr = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')} ${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}:${String(now.getSeconds()).padStart(2, '0')}`;
            document.getElementById('updateTime').textContent = `ÊúÄÂêéÊõ¥Êñ∞: ${timeStr}`;
        }

        // Âä†ËΩΩÊâÄÊúâÊï∞ÊçÆ
        async function loadDashboardData() {
            try {
                const result = await fetchAPI('/dashboard/stats');
                
                if (result.success && result.data) {
                    const data = result.data;

                    // Êõ¥Êñ∞ÂêÑ‰∏™ÈÉ®ÂàÜ
                    updateCoreStats(data);
                    updateRiskChart(data.riskDistribution || []);
                    updateTrendChart(data.assessmentTrend || []);
                    updateStageChart(data.stageDistribution || []);
                    updateStomaTypeChart(data.stomaTypeDistribution || []);
                    updateHighRiskList(data.highRiskPatients || []);
                    updatePendingList(data.pendingReviews || []);

                    // Êõ¥Êñ∞‰ªäÊó•Êï∞ÊçÆ
                    await updateTodayData();

                    // Êõ¥Êñ∞Êó∂Èó¥
                    updateTimeDisplay();
                }
            } catch (error) {
                console.error('Âä†ËΩΩÊï∞ÊçÆÂ§±Ë¥•:', error);
                showError('Êï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü•ÁΩëÁªúËøûÊé•ÂíåÂêéÁ´ØÊúçÂä°');
            }
        }

        // ÊòæÁ§∫ÈîôËØØ‰ø°ÊÅØ
        function showError(message) {
            const dashboardBody = document.getElementById('dashboardBody');
            const apiUrl = CONFIG.apiBaseUrl;
            const hasToken = !!CONFIG.token;
            
            dashboardBody.innerHTML = `
                <div class="error-message">
                    ‚ùå ${message}
                    <br><br>
                    <div style="font-size: 0.9em; opacity: 0.8; margin-top: 20px; text-align: left; max-width: 600px; margin-left: auto; margin-right: auto;">
                        <strong>ËØäÊñ≠‰ø°ÊÅØÔºö</strong><br>
                        ‚Ä¢ APIÂú∞ÂùÄ: ${apiUrl}<br>
                        ‚Ä¢ TokenÁä∂ÊÄÅ: ${hasToken ? 'Â∑≤ÈÖçÁΩÆ ‚úì' : 'Êú™ÈÖçÁΩÆ ‚úó'}<br>
                        ‚Ä¢ ÊµèËßàÂô®: ${navigator.userAgent.split(' ').pop()}<br><br>
                        <strong>ÂèØËÉΩÁöÑÂéüÂõ†Ôºö</strong><br>
                        1. ÂêéÁ´ØÊúçÂä°Êú™ÂêØÂä®ÔºàËØ∑Ê£ÄÊü• npm startÔºâ<br>
                        2. APIÂú∞ÂùÄÈÖçÁΩÆÈîôËØØÔºàÊ£ÄÊü• config.dev.jsÔºâ<br>
                        3. Êï∞ÊçÆÂ∫ìÊú™ÂàùÂßãÂåñÊàñÊó†Êï∞ÊçÆ<br>
                        4. TokenÂ∑≤ËøáÊúüÔºàËØ∑ÈáçÊñ∞ÁôªÂΩïÔºâ<br>
                        5. Ë∑®ÂüüÈóÆÈ¢òÔºàÊ£ÄÊü•ÂêéÁ´ØCORSÈÖçÁΩÆÔºâ<br>
                    </div>
                    <div style="margin-top: 30px;">
                        <button onclick="testConnection()" style="padding: 10px 20px; margin: 0 10px; background: #3b82f6; border: none; border-radius: 8px; color: white; cursor: pointer; font-size: 14px;">ÊµãËØïËøûÊé•</button>
                        <a href="login.html" style="display: inline-block; padding: 10px 20px; margin: 0 10px; background: #ef4444; border-radius: 8px; color: #fff; text-decoration: none; font-size: 14px;">ËøîÂõûÁôªÂΩï</a>
                    </div>
                </div>
            `;
        }
        
        // ÊµãËØïAPIËøûÊé•
        async function testConnection() {
            const resultDiv = document.querySelector('.error-message');
            resultDiv.innerHTML += '<div style="margin-top: 20px; padding: 15px; background: rgba(59, 130, 246, 0.2); border-radius: 8px; text-align: left; max-width: 600px; margin-left: auto; margin-right: auto;"><strong>Ê≠£Âú®ÊµãËØïËøûÊé•...</strong><br><br></div>';
            
            const tests = [
                { name: '1. ÂÅ•Â∫∑Ê£ÄÊü•', url: `${CONFIG.apiBaseUrl}/health`, auth: false },
                { name: '2. Dashboard API', url: `${CONFIG.apiBaseUrl}/dashboard/stats`, auth: true }
            ];
            
            const testDiv = resultDiv.querySelector('div:last-child');
            
            for (const test of tests) {
                testDiv.innerHTML += `<div style="margin: 10px 0;">ÊµãËØï ${test.name}...</div>`;
                try {
                    const headers = { 'Content-Type': 'application/json' };
                    if (test.auth && CONFIG.token) {
                        headers['Authorization'] = `Bearer ${CONFIG.token}`;
                    }
                    
                    const response = await fetch(test.url, { headers });
                    const data = await response.json();
                    
                    if (response.ok) {
                        testDiv.innerHTML += `<div style="color: #4ade80;">‚úì ${test.name}: ÊàêÂäü (${response.status})</div>`;
                        if (test.name.includes('ÂÅ•Â∫∑Ê£ÄÊü•')) {
                            testDiv.innerHTML += `<div style="color: #93c5fd; font-size: 0.85em; margin-left: 20px;">ÊúçÂä°Âô®ÂìçÂ∫î: ${data.message}</div>`;
                        }
                    } else {
                        testDiv.innerHTML += `<div style="color: #f87171;">‚úó ${test.name}: Â§±Ë¥• (${response.status})</div>`;
                        testDiv.innerHTML += `<div style="color: #fca5a5; font-size: 0.85em; margin-left: 20px;">ÈîôËØØ: ${data.message || 'Êú™Áü•ÈîôËØØ'}</div>`;
                    }
                } catch (error) {
                    testDiv.innerHTML += `<div style="color: #f87171;">‚úó ${test.name}: ÁΩëÁªúÈîôËØØ</div>`;
                    testDiv.innerHTML += `<div style="color: #fca5a5; font-size: 0.85em; margin-left: 20px;">ÈîôËØØ: ${error.message}</div>`;
                }
            }
            
            testDiv.innerHTML += '<br><strong>ÊµãËØïÂÆåÊàê</strong>';
        }

        // ÂàùÂßãÂåñ
        async function init() {
            // Ê∏ÖÈô§Êù•Ëá™ login ÁöÑÊ†áËÆ∞
            sessionStorage.removeItem('toIndex');
            
            // Ê£ÄÊü•token
            if (!CONFIG.token) {
                console.log('Êú™Ê£ÄÊµãÂà∞ÁôªÂΩïtokenÔºåË∑≥ËΩ¨Âà∞ÁôªÂΩïÈ°µÈù¢...');
                // ËÆæÁΩÆÊ†áËÆ∞ÔºåË°®Á§∫ÊòØ‰ªé index Ë∑≥ËΩ¨Âà∞ login
                sessionStorage.setItem('fromIndex', 'true');
                window.location.href = 'login.html';
                return;
            }

            // ÂàõÂª∫Á≤íÂ≠êËÉåÊôØ
            createParticles();

            // ÂàùÂßãÂåñÂõæË°®
            initCharts();

            // Âä†ËΩΩÊï∞ÊçÆ
            await loadDashboardData();

            // ÂÆöÊó∂Âà∑Êñ∞
            setInterval(loadDashboardData, CONFIG.refreshInterval);
        }

        // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÂàùÂßãÂåñ
        window.addEventListener('load', init);

        // ÊâãÂä®Âà∑Êñ∞ÔºàÊåâF5ÊàñÁÇπÂáªÂà∑Êñ∞ÊåâÈíÆÔºâ
        window.addEventListener('keydown', (e) => {
            if (e.key === 'F5') {
                e.preventDefault();
                loadDashboardData();
            }
        });

        // ÈÄÄÂá∫ÁôªÂΩï
        function logout() {
            if (confirm('Á°ÆÂÆöË¶ÅÈÄÄÂá∫ÁôªÂΩïÂêóÔºü')) {
                // Ê∏ÖÈô§tokenÂíåÁî®Êà∑‰ø°ÊÅØ
                localStorage.removeItem('token');
                localStorage.removeItem('userInfo');
                // ËÆæÁΩÆÊ†áËÆ∞ÔºåË°®Á§∫ÊòØ‰ªé index ‰∏ªÂä®ÈÄÄÂá∫
                sessionStorage.setItem('fromIndex', 'true');
                console.log('Â∑≤ÈÄÄÂá∫ÁôªÂΩïÔºåË∑≥ËΩ¨Âà∞ÁôªÂΩïÈ°µÈù¢...');
                // Ë∑≥ËΩ¨Âà∞ÁôªÂΩïÈ°µÈù¢
                window.location.href = 'login.html';
            }
        }
    </script>
</body>
</html>


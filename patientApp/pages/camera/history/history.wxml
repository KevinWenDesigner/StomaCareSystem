<!--patient-app/pages/camera/history/history.wxml-->
<view class="container">
  <!-- 页面标题 -->
  <view class="page-header">
    <text class="page-title">历史评估记录</text>
    <text class="page-subtitle">查看您的所有AI评估记录</text>
  </view>

  <!-- 操作按钮 -->
  <view class="action-bar">
    <button class="action-btn" bindtap="exportRecords">
      <text class="btn-text">导出记录</text>
    </button>
    <button class="action-btn danger" bindtap="clearAllRecords">
      <text class="btn-text">清空记录</text>
    </button>
  </view>

  <!-- 统计信息 -->
  <view class="stats-section">
    <view class="stats-card">
      <view class="stats-item">
        <text class="stats-number">{{historyList.length}}</text>
        <text class="stats-label">总记录数</text>
      </view>
      <view class="stats-item">
        <text class="stats-number">{{averageScore}}</text>
        <text class="stats-label">平均评分</text>
      </view>
      <view class="stats-item">
        <text class="stats-number">{{latestRecord}}</text>
        <text class="stats-label">最近评估</text>
      </view>
    </view>
  </view>

  <!-- 加载状态 -->
  <view wx:if="{{loading}}" class="loading-section">
    <view class="loading-spinner"></view>
    <text class="loading-text">加载中...</text>
  </view>

  <!-- 空状态 -->
  <view wx:elif="{{historyList.length === 0}}" class="empty-state">
    <text class="empty-icon">📊</text>
    <text class="empty-text">暂无评估记录</text>
    <text class="empty-subtext">开始拍照评估，记录您的造口状态</text>
    <button class="empty-btn" bindtap="goToCamera">
      <text class="btn-text">开始评估</text>
    </button>
  </view>

  <!-- 历史记录列表 -->
  <view wx:else class="history-list">
    <view wx:for="{{historyList}}" wx:key="id" class="history-item">
      <view class="history-card" bindtap="viewDetail" data-id="{{item.id}}">
        <!-- 照片预览 -->
        <view class="history-image-container">
          <image src="{{item.photoPath}}" mode="aspectFill" class="history-image"></image>
          <view class="image-overlay">
            <text class="overlay-text">点击查看详情</text>
          </view>
        </view>
        
        <!-- 记录信息 -->
        <view class="history-content">
          <view class="history-header">
            <text class="history-time">{{item.time}}</text>
            <view class="history-score score-{{item.level}}">
              <text class="score-text">{{item.score}}分</text>
            </view>
          </view>
          
          <view class="history-details">
            <view class="detail-row">
              <text class="detail-label">评估等级</text>
              <text class="detail-value">{{item.levelText}}</text>
            </view>
            <view class="detail-row">
              <text class="detail-label">评估描述</text>
              <text class="detail-value description">{{item.description}}</text>
            </view>
          </view>
        </view>
        
        <!-- 操作按钮 -->
        <view class="history-actions">
          <button class="action-icon-btn" bindtap="shareRecord" data-id="{{item.id}}">
            <text class="icon-text">📤</text>
          </button>
          <button class="action-icon-btn danger" bindtap="deleteRecord" data-id="{{item.id}}">
            <text class="icon-text">🗑️</text>
          </button>
        </view>
      </view>
    </view>
  </view>

  <!-- 加载更多 -->
  <view wx:if="{{historyList.length > 0 && hasMore}}" class="load-more">
    <text class="load-more-text">上拉加载更多</text>
  </view>

  <!-- 底部提示 -->
  <view wx:if="{{historyList.length > 0}}" class="bottom-tip">
    <text class="tip-text">共{{historyList.length}}条评估记录</text>
  </view>
</view> 
<!--patient-app/pages/camera/camera.wxml-->
<view class="container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <text class="page-title">AIæ™ºèƒ½è¯„ä¼°</text>
    <text class="page-subtitle">æ‹ç…§è·å¾—ä¸“ä¸šè¯„ä¼°å»ºè®®</text>
  </view>

  <!-- è‡ªåŠ¨æ‹ç…§æ¨¡å¼ -->
  <view class="auto-capture-section">
    <view class="auto-capture-card">
      <view class="auto-capture-header">
        <text class="auto-capture-title">è‡ªåŠ¨æ‹ç…§æ¨¡å¼</text>
        <text class="auto-capture-desc">3ç§’å€’è®¡æ—¶è‡ªåŠ¨æ‹ç…§ï¼Œç¡®ä¿æ‹æ‘„ç¨³å®š</text>
      </view>
      
      <view class="auto-capture-controls">
        <button class="auto-capture-btn {{autoCapture ? 'active' : ''}}" bindtap="toggleAutoCapture">
          <text class="btn-text">{{autoCapture ? 'å–æ¶ˆè‡ªåŠ¨' : 'å¼€å¯è‡ªåŠ¨'}}</text>
        </button>
        
        <view wx:if="{{autoCapture}}" class="countdown-display">
          <text class="countdown-text">{{captureCountdown}}</text>
          <text class="countdown-label">ç§’åæ‹ç…§</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æ‹ç…§åŒºåŸŸ -->
  <view class="camera-section">
    <view class="camera-preview">
      <view wx:if="{{!photoPath}}" class="camera-placeholder">
        <text class="camera-icon">ğŸ“·</text>
        <text class="camera-tip">ç‚¹å‡»æ‹ç…§å¼€å§‹è¯„ä¼°</text>
        <text class="camera-subtip">å»ºè®®åœ¨å…‰çº¿å……è¶³çš„ç¯å¢ƒä¸‹æ‹æ‘„</text>
      </view>
      <image wx:else src="{{photoPath}}" mode="aspectFit" class="camera-image"></image>
    </view>
    
    <view class="camera-actions">
      <button class="camera-btn" bindtap="takePhoto">
        <text class="btn-text">æ‹ç…§è¯„ä¼°</text>
      </button>
      <button class="camera-btn outline" bindtap="chooseImage">
        <text class="btn-text">é€‰æ‹©ç…§ç‰‡</text>
      </button>
    </view>
  </view>

  <!-- AIåˆ†æè¿›åº¦ -->
  <view wx:if="{{isAnalyzing}}" class="analysis-section">
    <view class="analysis-card">
      <view class="analysis-header">
        <text class="analysis-title">AIåˆ†æä¸­...</text>
        <text class="analysis-progress">{{analysisProgress}}%</text>
      </view>
      
      <view class="progress-bar">
        <view class="progress-fill" style="width: {{analysisProgress}}%"></view>
      </view>
      
      <view class="analysis-steps">
        <view class="step-item {{analysisProgress >= 20 ? 'completed' : ''}}">
          <text class="step-icon">ğŸ”</text>
          <text class="step-text">å›¾åƒé¢„å¤„ç†</text>
        </view>
        <view class="step-item {{analysisProgress >= 40 ? 'completed' : ''}}">
          <text class="step-icon">ğŸ¤–</text>
          <text class="step-text">AIè¯†åˆ«åˆ†æ</text>
        </view>
        <view class="step-item {{analysisProgress >= 60 ? 'completed' : ''}}">
          <text class="step-icon">ğŸ“Š</text>
          <text class="step-text">ç—‡çŠ¶è¯„ä¼°</text>
        </view>
        <view class="step-item {{analysisProgress >= 80 ? 'completed' : ''}}">
          <text class="step-icon">ğŸ’¡</text>
          <text class="step-text">ç”Ÿæˆå»ºè®®</text>
        </view>
      </view>
    </view>
  </view>

  <!-- è¯„ä¼°ç»“æœ -->
  <view wx:if="{{assessmentResult}}" class="result-section">
    <view class="section-header">
      <text class="section-title">è¯„ä¼°ç»“æœ</text>
      <text class="section-subtitle">{{assessmentTime}}</text>
    </view>
    
    <view class="result-card">
      <view class="result-header">
        <text class="result-title">é€ å£çŠ¶æ€è¯„ä¼°</text>
        <view class="result-score score-{{assessmentResult.level}}">
          <text class="score-text">{{assessmentResult.score}}åˆ†</text>
        </view>
      </view>
      
      <text class="result-desc">{{assessmentResult.description}}</text>
      
      <!-- AIåˆ†ææŒ‡æ ‡ -->
      <view class="analysis-metrics">
        <view class="metric-item">
          <text class="metric-label">å‘çº¢ç¨‹åº¦</text>
          <view class="metric-bar">
            <view class="metric-fill" style="width: {{assessmentResult.analysis.redness}}%"></view>
          </view>
          <text class="metric-value">{{assessmentResult.analysis.redness}}%</text>
        </view>
        
        <view class="metric-item">
          <text class="metric-label">è‚¿èƒ€ç¨‹åº¦</text>
          <view class="metric-bar">
            <view class="metric-fill" style="width: {{assessmentResult.analysis.swelling}}%"></view>
          </view>
          <text class="metric-value">{{assessmentResult.analysis.swelling}}%</text>
        </view>
        
        <view class="metric-item">
          <text class="metric-label">æ„ŸæŸ“é£é™©</text>
          <view class="metric-bar">
            <view class="metric-fill" style="width: {{assessmentResult.analysis.infection}}%"></view>
          </view>
          <text class="metric-value">{{assessmentResult.analysis.infection}}%</text>
        </view>
        
        <view class="metric-item">
          <text class="metric-label">æ„ˆåˆç¨‹åº¦</text>
          <view class="metric-bar">
            <view class="metric-fill" style="width: {{assessmentResult.analysis.healing}}%"></view>
          </view>
          <text class="metric-value">{{assessmentResult.analysis.healing}}%</text>
        </view>
      </view>
      
      <view class="result-details">
        <view class="detail-item">
          <text class="detail-label">è¯„ä¼°ç­‰çº§</text>
          <text class="detail-value">{{assessmentResult.levelText}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">å»ºè®®æªæ–½</text>
          <text class="detail-value">{{assessmentResult.suggestion}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">æ³¨æ„äº‹é¡¹</text>
          <text class="detail-value">{{assessmentResult.attention}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- å†å²è®°å½• -->
  <view class="history-section">
    <view class="section-header">
      <text class="section-title">å†å²è¯„ä¼°</text>
      <button class="view-all-btn" bindtap="viewHistory">
        <text class="btn-text">æŸ¥çœ‹å…¨éƒ¨</text>
      </button>
    </view>
    
    <view wx:if="{{historyList.length === 0}}" class="empty-state">
      <text class="empty-icon">ğŸ“Š</text>
      <text class="empty-text">æš‚æ— è¯„ä¼°è®°å½•</text>
      <text class="empty-subtext">å¼€å§‹æ‹ç…§è¯„ä¼°ï¼Œè®°å½•æ‚¨çš„é€ å£çŠ¶æ€</text>
    </view>
    
    <view wx:else class="history-list">
      <view wx:for="{{historyList}}" wx:key="id" class="history-item">
        <view class="history-card">
          <image src="{{item.photoPath}}" mode="aspectFill" class="history-image"></image>
          <view class="history-content">
            <text class="history-time">{{item.time}}</text>
            <text class="history-score">è¯„åˆ†: {{item.score}}åˆ†</text>
            <text class="history-level">{{item.levelText}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>
</view> 
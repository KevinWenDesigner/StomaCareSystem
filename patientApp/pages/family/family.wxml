<!--patient-app/pages/family/family.wxml-->
<view class="container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <view class="header-left" bindtap="goBack">
      <text class="back-icon">â†</text>
    </view>
    <text class="page-title">å®¶å±ç®¡ç†</text>
    <view class="header-right">
      <text class="add-btn" bindtap="showAddMember">+ æ·»åŠ </text>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-state">
    <text class="loading-text">åŠ è½½å®¶å±æ•°æ®ä¸­...</text>
  </view>

  <!-- å®¶å±ç®¡ç†å†…å®¹ -->
  <view wx:else class="family-content">
    <!-- æ ‡ç­¾é¡µå¯¼èˆª -->
    <view class="tab-navigation">
      <view class="tab-item {{currentTab === 'contacts' ? 'active' : ''}}" 
            bindtap="switchTab" data-tab="contacts">
        <text class="tab-text">è”ç³»äºº</text>
      </view>
      <view class="tab-item {{currentTab === 'emergency' ? 'active' : ''}}" 
            bindtap="switchTab" data-tab="emergency">
        <text class="tab-text">ç´§æ€¥è”ç³»äºº</text>
      </view>
    </view>

    <!-- è”ç³»äººé¡µé¢ -->
    <view wx:if="{{currentTab === 'contacts'}}" class="contacts-section">
      <!-- å®¶å±åˆ—è¡¨ -->
      <view class="family-list">
        <view wx:for="{{familyMembers}}" wx:key="id" class="family-item">
          <view class="member-info">
            <view class="member-avatar">
              <text class="avatar-text">{{item.avatar}}</text>
            </view>
            <view class="member-details">
              <view class="member-header">
                <text class="member-name">{{item.name}}</text>
                <view wx:if="{{item.isEmergency}}" class="emergency-badge">
                  <text class="badge-text">ç´§æ€¥</text>
                </view>
              </view>
              <text class="member-relationship">{{item.relationship}}</text>
              <text class="member-phone">{{item.phone}}</text>
              <text class="member-last-contact">æœ€åè”ç³»ï¼š{{item.lastContact}}</text>
            </view>
          </view>
          
          <view class="member-actions">
            <view class="action-btn contact-btn" bindtap="contactMember" data-id="{{item.id}}">
              <text class="action-text">è”ç³»</text>
            </view>
            <view class="action-btn edit-btn" bindtap="showEditMember" data-id="{{item.id}}">
              <text class="action-text">ç¼–è¾‘</text>
            </view>
            <view class="action-btn emergency-btn {{item.isEmergency ? 'active' : ''}}" 
                  bindtap="setEmergencyContact" data-id="{{item.id}}">
              <text class="action-text">{{item.isEmergency ? 'å–æ¶ˆç´§æ€¥' : 'è®¾ä¸ºç´§æ€¥'}}</text>
            </view>
            <view class="action-btn delete-btn" bindtap="deleteMember" data-id="{{item.id}}">
              <text class="action-text">åˆ é™¤</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- ç´§æ€¥è”ç³»äººé¡µé¢ -->
    <view wx:if="{{currentTab === 'emergency'}}" class="emergency-section">
      <view class="emergency-list">
        <view wx:for="{{familyMembers}}" wx:key="id" wx:if="{{item.isEmergency}}" 
              class="emergency-item">
          <view class="emergency-info">
            <view class="emergency-avatar">
              <text class="avatar-text">{{item.avatar}}</text>
            </view>
            <view class="emergency-details">
              <text class="emergency-name">{{item.name}}</text>
              <text class="emergency-relationship">{{item.relationship}}</text>
              <text class="emergency-phone">{{item.phone}}</text>
            </view>
          </view>
          <view class="emergency-actions">
            <view class="action-btn contact-btn" bindtap="contactMember" data-id="{{item.id}}">
              <text class="action-text">ç«‹å³è”ç³»</text>
            </view>
            <view class="action-btn cancel-btn" bindtap="setEmergencyContact" data-id="{{item.id}}">
              <text class="action-text">å–æ¶ˆç´§æ€¥</text>
            </view>
          </view>
        </view>
        
        <view wx:if="{{!hasEmergencyContacts}}" class="empty-emergency">
          <text class="empty-icon">ğŸš¨</text>
          <text class="empty-text">æš‚æ— ç´§æ€¥è”ç³»äºº</text>
          <text class="empty-desc">å»ºè®®è®¾ç½®1-3ä¸ªç´§æ€¥è”ç³»äºº</text>
        </view>
      </view>
    </view>


  </view>

  <!-- æ·»åŠ å®¶å±æ¨¡æ€æ¡† -->
  <view wx:if="{{showAddModal}}" class="modal-overlay">
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">æ·»åŠ å®¶å±</text>
        <text class="modal-close" bindtap="closeAddModal">Ã—</text>
      </view>
      
      <view class="modal-body">
        <view class="form-item">
          <text class="form-label">å§“å</text>
          <input class="form-input" placeholder="è¯·è¾“å…¥å§“å" 
                 value="{{newMember.name}}" bindinput="inputNewMember" data-field="name" />
        </view>
        
        <view class="form-item">
          <text class="form-label">å…³ç³»</text>
          <view class="relationship-selector">
            <view wx:for="{{relationshipOptions}}" wx:key="*this" 
                  class="relationship-option {{newMember.relationship === item ? 'selected' : ''}}"
                  bindtap="selectRelationship" data-relationship="{{item}}">
              <text class="option-text">{{item}}</text>
            </view>
          </view>
        </view>
        
        <view class="form-item">
          <text class="form-label">æ‰‹æœºå·</text>
          <input class="form-input" placeholder="è¯·è¾“å…¥æ‰‹æœºå·" 
                 value="{{newMember.phone}}" bindinput="inputNewMember" data-field="phone" />
        </view>
      </view>
      
      <view class="modal-footer">
        <button class="modal-btn secondary" bindtap="closeAddModal">
          <text class="btn-text">å–æ¶ˆ</text>
        </button>
        <button class="modal-btn primary" bindtap="addMember">
          <text class="btn-text">æ·»åŠ </text>
        </button>
      </view>
    </view>
  </view>

  <!-- ç¼–è¾‘å®¶å±æ¨¡æ€æ¡† -->
  <view wx:if="{{showEditModal}}" class="modal-overlay">
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">ç¼–è¾‘å®¶å±</text>
        <text class="modal-close" bindtap="closeEditModal">Ã—</text>
      </view>
      
      <view class="modal-body">
        <view class="form-item">
          <text class="form-label">å§“å</text>
          <input class="form-input" placeholder="è¯·è¾“å…¥å§“å" 
                 value="{{currentMember.name}}" bindinput="inputEditMember" data-field="name" />
        </view>
        
        <view class="form-item">
          <text class="form-label">å…³ç³»</text>
          <view class="relationship-selector">
            <view wx:for="{{relationshipOptions}}" wx:key="*this" 
                  class="relationship-option {{currentMember.relationship === item ? 'selected' : ''}}"
                  bindtap="selectRelationship" data-relationship="{{item}}">
              <text class="option-text">{{item}}</text>
            </view>
          </view>
        </view>
        
        <view class="form-item">
          <text class="form-label">æ‰‹æœºå·</text>
          <input class="form-input" placeholder="è¯·è¾“å…¥æ‰‹æœºå·" 
                 value="{{currentMember.phone}}" bindinput="inputEditMember" data-field="phone" />
        </view>
      </view>
      
      <view class="modal-footer">
        <button class="modal-btn secondary" bindtap="closeEditModal">
          <text class="btn-text">å–æ¶ˆ</text>
        </button>
        <button class="modal-btn primary" bindtap="saveEdit">
          <text class="btn-text">ä¿å­˜</text>
        </button>
      </view>
    </view>
  </view>


</view> 
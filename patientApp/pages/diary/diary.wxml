<!--patient-app/pages/diary/diary.wxml-->
<view class="container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <text class="page-title">ç—‡çŠ¶æ—¥è®°</text>
    <text class="page-subtitle">è®°å½•æ¯æ—¥ç—‡çŠ¶å˜åŒ–</text>
  </view>

  <!-- å¿«é€Ÿè®°å½• -->
  <view class="quick-record">
    <view class="record-card">
      <view class="record-header">
        <view class="title-section">
          <text class="record-title">{{isEditing ? 'ç¼–è¾‘è®°å½•' : 'ä»Šæ—¥ç—‡çŠ¶'}}</text>
          <text wx:if="{{isEditing}}" class="edit-badge">ç¼–è¾‘ä¸­</text>
        </view>
        <text class="record-date">{{isEditing ? editingRecord.date : todayDate}}</text>
      </view>
      
      <view class="symptom-form">
        <view class="form-group">
          <text class="form-label">ç–¼ç—›ç¨‹åº¦</text>
          <view class="pain-scale">
            <view wx:for="{{painLevels}}" wx:key="level" 
                  class="pain-item {{selectedPainLevel === item.level ? 'active' : ''}}"
                  bindtap="selectPainLevel" data-level="{{item.level}}">
              <text class="pain-number">{{item.level}}</text>
              <text class="pain-desc">{{item.desc}}</text>
            </view>
          </view>
        </view>
        
        <view class="form-group">
          <view class="form-label-row">
            <text class="form-label">ç—‡çŠ¶ç±»å‹</text>
            <text wx:if="{{selectedSymptoms.length > 0}}" class="selection-count">å·²é€‰æ‹© {{selectedSymptoms.length}} é¡¹</text>
          </view>
          <view class="symptom-tags">
            <view wx:for="{{symptomTypes}}" wx:key="type" 
                  class="symptom-tag {{item.selected ? 'selected' : ''}}"
                  bindtap="toggleSymptom" data-type="{{item.type}}">
              <text class="tag-text">{{item.name}}</text>
            </view>
          </view>
        </view>
        
        <view class="form-group">
          <text class="form-label">å¤‡æ³¨è¯´æ˜</text>
          <textarea class="form-textarea" placeholder="è¯·æè¿°æ‚¨çš„ç—‡çŠ¶æ„Ÿå—..." 
                    value="{{symptomNote}}" bindinput="onNoteInput"></textarea>
        </view>
      </view>
      
      <view class="action-buttons">
        <button wx:if="{{isEditing}}" class="cancel-btn" bindtap="cancelEdit">
          <text class="btn-text">å–æ¶ˆ</text>
        </button>
        <button class="submit-btn" bindtap="submitRecord">
          <text class="btn-text">{{isEditing ? 'ä¿å­˜ä¿®æ”¹' : 'æäº¤è®°å½•'}}</text>
        </button>
      </view>
    </view>
  </view>

  <!-- ç»Ÿè®¡æ¦‚è§ˆ -->
  <view class="stats-section">
    <view class="section-header">
      <text class="section-title">æœ¬å‘¨ç»Ÿè®¡</text>
      <text class="section-subtitle">ç—‡çŠ¶å˜åŒ–è¶‹åŠ¿</text>
    </view>
    
    <view class="stats-grid">
      <view class="stat-card">
        <view class="stat-icon">ğŸ“Š</view>
        <view class="stat-content">
          <text class="stat-number">{{weeklyStats.records}}</text>
          <text class="stat-label">è®°å½•å¤©æ•°</text>
        </view>
      </view>
      
      <view class="stat-card">
        <view class="stat-icon">ğŸ˜£</view>
        <view class="stat-content">
          <text class="stat-number">{{weeklyStats.avgPain}}/5</text>
          <text class="stat-label">å¹³å‡ç–¼ç—›</text>
        </view>
      </view>
      
      <view class="stat-card">
        <view class="stat-icon">ğŸ“ˆ</view>
        <view class="stat-content">
          <text class="stat-number">{{weeklyStats.trend}}</text>
          <text class="stat-label">ç—‡çŠ¶è¶‹åŠ¿</text>
        </view>
      </view>
      
      <view class="stat-card">
        <view class="stat-icon">ğŸ¯</view>
        <view class="stat-content">
          <text class="stat-number">{{weeklyStats.score}}</text>
          <text class="stat-label">å¥åº·è¯„åˆ†</text>
        </view>
      </view>
    </view>
  </view>

  <!-- å†å²è®°å½• -->
  <view class="history-section">
    <view class="section-header">
      <text class="section-title">å†å²è®°å½•</text>
      <view class="filter-tabs">
        <text class="filter-tab {{currentFilter === 'all' ? 'active' : ''}}" 
              bindtap="switchFilter" data-filter="all">å…¨éƒ¨</text>
        <text class="filter-tab {{currentFilter === 'week' ? 'active' : ''}}" 
              bindtap="switchFilter" data-filter="week">æœ¬å‘¨</text>
        <text class="filter-tab {{currentFilter === 'month' ? 'active' : ''}}" 
              bindtap="switchFilter" data-filter="month">æœ¬æœˆ</text>
      </view>
    </view>
    
    <view wx:if="{{filteredRecords.length === 0}}" class="empty-state">
      <text class="empty-icon">ğŸ“</text>
      <text class="empty-text">æš‚æ— è®°å½•</text>
      <text class="empty-subtext">å¼€å§‹è®°å½•æ‚¨çš„ç—‡çŠ¶å˜åŒ–</text>
    </view>
    
    <view wx:else class="records-list">
      <view wx:for="{{filteredRecords}}" wx:key="id" class="record-item">
        <view class="record-card">
          <view class="record-header">
            <text class="record-date">{{item.date}}</text>
            <view class="record-pain">
              <text class="pain-label">ç–¼ç—›:</text>
              <text class="pain-value">{{item.painLevel}}/5</text>
            </view>
          </view>
          
          <view class="record-symptoms">
            <view wx:for="{{item.symptoms}}" wx:key="type" wx:for-item="symptom" 
                  class="symptom-tag small">
              <text class="tag-text">{{symptom}}</text>
            </view>
          </view>
          
          <text wx:if="{{item.note}}" class="record-note">{{item.note}}</text>
          
          <view class="record-actions">
            <button class="action-btn" data-id="{{item.id}}" bindtap="editRecord">
              <text class="action-text">ç¼–è¾‘</text>
            </button>
            <button class="action-btn danger" data-id="{{item.id}}" bindtap="deleteRecord">
              <text class="action-text">åˆ é™¤</text>
            </button>
          </view>
        </view>
      </view>
    </view>
  </view>
</view> 
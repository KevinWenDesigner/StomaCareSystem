<!--patient-app/pages/health-report/health-report.wxml-->
<view class="container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <view class="header-left" bindtap="goBack">
      <text class="back-icon">â†</text>
    </view>
    <text class="page-title">å¥åº·æŠ¥å‘Š</text>
    <view class="header-right">
      <text class="share-btn" bindtap="shareReport">åˆ†äº«</text>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-state">
    <text class="loading-text">ç”Ÿæˆå¥åº·æŠ¥å‘Šä¸­...</text>
  </view>

  <!-- å¥åº·æŠ¥å‘Šå†…å®¹ -->
  <view wx:else class="report-content">
    <!-- æ ‡ç­¾é¡µå¯¼èˆª -->
    <view class="tab-navigation">
      <view class="tab-item {{currentTab === 'overview' ? 'active' : ''}}" 
            bindtap="switchTab" data-tab="overview">
        <text class="tab-text">æ€»è§ˆ</text>
      </view>
      <view class="tab-item {{currentTab === 'trends' ? 'active' : ''}}" 
            bindtap="switchTab" data-tab="trends">
        <text class="tab-text">è¶‹åŠ¿</text>
      </view>
      <view class="tab-item {{currentTab === 'analysis' ? 'active' : ''}}" 
            bindtap="switchTab" data-tab="analysis">
        <text class="tab-text">åˆ†æ</text>
      </view>
    </view>

    <!-- æ€»è§ˆé¡µé¢ -->
    <view wx:if="{{currentTab === 'overview'}}" class="overview-section">
      <!-- å¥åº·è¯„åˆ† -->
      <view class="health-score-card">
        <view class="score-header">
          <text class="score-title">å¥åº·è¯„åˆ†</text>
          <text class="score-date">{{healthData.basicInfo.stomaDate}}</text>
        </view>
        <view class="score-display">
          <text class="score-value">{{healthData.healthScore}}</text>
          <text class="score-unit">åˆ†</text>
        </view>
        <view class="score-status">
          <text wx:if="{{healthData.healthScore >= 80}}" class="status-text good">ä¼˜ç§€</text>
          <text wx:elif="{{healthData.healthScore >= 60}}" class="status-text normal">è‰¯å¥½</text>
          <text wx:else class="status-text poor">éœ€å…³æ³¨</text>
        </view>
      </view>

      <!-- åŸºæœ¬ä¿¡æ¯ -->
      <view class="info-section">
        <view class="section-header">
          <text class="section-title">åŸºæœ¬ä¿¡æ¯</text>
        </view>
        <view class="info-grid">
          <view class="info-item">
            <text class="info-label">å§“å</text>
            <text class="info-value">{{healthData.basicInfo.name}}</text>
          </view>
          <view class="info-item">
            <text class="info-label">å¹´é¾„</text>
            <text class="info-value">{{healthData.basicInfo.age}}å²</text>
          </view>
          <view class="info-item">
            <text class="info-label">æ€§åˆ«</text>
            <text class="info-value">{{healthData.basicInfo.gender}}</text>
          </view>
          <view class="info-item">
            <text class="info-label">é€ å£ç±»å‹</text>
            <text class="info-value">{{healthData.basicInfo.stomaType}}</text>
          </view>
          <view class="info-item">
            <text class="info-label">é€ å£æ—¥æœŸ</text>
            <text class="info-value">{{healthData.basicInfo.stomaDate}}</text>
          </view>
          <view class="info-item">
            <text class="info-label">æœ¯åå¤©æ•°</text>
            <text class="info-value">{{healthData.basicInfo.daysSince}}å¤©</text>
          </view>
        </view>
      </view>

      <!-- ç”Ÿå‘½ä½“å¾ -->
      <view class="vitals-section">
        <view class="section-header">
          <text class="section-title">ç”Ÿå‘½ä½“å¾</text>
        </view>
        <view class="vitals-grid">
          <view class="vital-item">
            <text class="vital-icon">ğŸŒ¡ï¸</text>
            <text class="vital-label">ä½“æ¸©</text>
            <text class="vital-value">{{healthData.vitalSigns.temperature}}Â°C</text>
          </view>
          <view class="vital-item">
            <text class="vital-icon">ğŸ’“</text>
            <text class="vital-label">è¡€å‹</text>
            <text class="vital-value">{{healthData.vitalSigns.bloodPressure}}</text>
          </view>
          <view class="vital-item">
            <text class="vital-icon">â¤ï¸</text>
            <text class="vital-label">å¿ƒç‡</text>
            <text class="vital-value">{{healthData.vitalSigns.heartRate}}æ¬¡/åˆ†</text>
          </view>
          <view class="vital-item">
            <text class="vital-icon">âš–ï¸</text>
            <text class="vital-label">ä½“é‡</text>
            <text class="vital-value">{{healthData.vitalSigns.weight}}kg</text>
          </view>
          <view class="vital-item">
            <text class="vital-icon">ğŸ“Š</text>
            <text class="vital-label">BMI</text>
            <text class="vital-value">{{healthData.vitalSigns.bmi}}</text>
          </view>
        </view>
      </view>

      <!-- é€ å£çŠ¶æ€ -->
      <view class="stoma-section">
        <view class="section-header">
          <text class="section-title">é€ å£çŠ¶æ€</text>
        </view>
        <view class="stoma-grid">
          <view class="stoma-item">
            <text class="stoma-label">é¢œè‰²</text>
            <text class="stoma-value {{healthData.stomaStatus.color === 'æ­£å¸¸' ? 'normal' : 'warning'}}">{{healthData.stomaStatus.color}}</text>
          </view>
          <view class="stoma-item">
            <text class="stoma-label">å¤§å°</text>
            <text class="stoma-value">{{healthData.stomaStatus.size}}</text>
          </view>
          <view class="stoma-item">
            <text class="stoma-label">é«˜åº¦</text>
            <text class="stoma-value">{{healthData.stomaStatus.height}}</text>
          </view>
          <view class="stoma-item">
            <text class="stoma-label">çš®è‚¤çŠ¶å†µ</text>
            <text class="stoma-value {{healthData.stomaStatus.skinCondition === 'è‰¯å¥½' ? 'normal' : 'warning'}}">{{healthData.stomaStatus.skinCondition}}</text>
          </view>
          <view class="stoma-item">
            <text class="stoma-label">æœ€åæ›´æ¢</text>
            <text class="stoma-value">{{healthData.stomaStatus.lastChange}}</text>
          </view>
        </view>
      </view>

      <!-- ç—‡çŠ¶è¯„ä¼° -->
      <view class="symptoms-section">
        <view class="section-header">
          <text class="section-title">ç—‡çŠ¶è¯„ä¼°</text>
        </view>
        <view class="symptoms-grid">
          <view class="symptom-item">
            <text class="symptom-label">ç–¼ç—›ç¨‹åº¦</text>
            <view class="symptom-value-container">
              <text class="symptom-value {{healthData.symptoms.pain <= 2 ? 'normal' : healthData.symptoms.pain <= 3 ? 'warning' : 'danger'}}">{{healthData.symptoms.pain}}/5</text>
            </view>
          </view>
          <view class="symptom-item">
            <text class="symptom-label">å‡ºè¡€æƒ…å†µ</text>
            <text class="symptom-value {{healthData.symptoms.bleeding === 'æ— ' ? 'normal' : 'danger'}}">{{healthData.symptoms.bleeding}}</text>
          </view>
          <view class="symptom-item">
            <text class="symptom-label">æ„ŸæŸ“æƒ…å†µ</text>
            <text class="symptom-value {{healthData.symptoms.infection === 'æ— ' ? 'normal' : 'danger'}}">{{healthData.symptoms.infection}}</text>
          </view>
          <view class="symptom-item">
            <text class="symptom-label">æ¢—é˜»æƒ…å†µ</text>
            <text class="symptom-value {{healthData.symptoms.obstruction === 'æ— ' ? 'normal' : 'danger'}}">{{healthData.symptoms.obstruction}}</text>
          </view>
          <view class="symptom-item">
            <text class="symptom-label">è„±å‚æƒ…å†µ</text>
            <text class="symptom-value {{healthData.symptoms.prolapse === 'æ— ' ? 'normal' : 'danger'}}">{{healthData.symptoms.prolapse}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- è¶‹åŠ¿é¡µé¢ -->
    <view wx:if="{{currentTab === 'trends'}}" class="trends-section">
      <!-- å‘¨è¶‹åŠ¿ -->
      <view class="trend-card">
        <view class="trend-header">
          <text class="trend-title">æœ¬å‘¨è¶‹åŠ¿</text>
          <text class="trend-subtitle">æœ€è¿‘7å¤©æ•°æ®</text>
        </view>
        <view class="trend-chart">
          <view class="chart-item">
            <text class="chart-label">ç–¼ç—›ç¨‹åº¦</text>
            <view class="chart-bars-container">
              <view class="chart-bars">
                <view wx:for="{{weeklyStats.painLevel}}" wx:key="*this" 
                      class="chart-bar {{item >= 4 ? 'high' : item >= 2 ? 'medium' : 'low'}}" 
                      style="height: {{item * 15}}%">
                  <view class="bar-fill"></view>
                  <text class="bar-value">{{item}}</text>
                </view>
              </view>
              <view class="chart-axis">
                <text class="axis-label">0</text>
                <text class="axis-label">5</text>
              </view>
            </view>
          </view>
          <view class="chart-item">
            <text class="chart-label">æ’ä¾¿æ¬¡æ•°</text>
            <view class="chart-bars-container">
              <view class="chart-bars">
                <view wx:for="{{weeklyStats.bowelMovements}}" wx:key="*this" 
                      class="chart-bar {{item >= 3 ? 'high' : item >= 1 ? 'medium' : 'low'}}" 
                      style="height: {{item * 20}}%">
                  <view class="bar-fill"></view>
                  <text class="bar-value">{{item}}</text>
                </view>
              </view>
              <view class="chart-axis">
                <text class="axis-label">0</text>
                <text class="axis-label">5</text>
              </view>
            </view>
          </view>
          <view class="chart-item">
            <text class="chart-label">çš®è‚¤é—®é¢˜</text>
            <view class="chart-bars-container">
              <view class="chart-bars">
                <view wx:for="{{weeklyStats.skinIssues}}" wx:key="*this" 
                      class="chart-bar {{item >= 3 ? 'high' : item >= 1 ? 'medium' : 'low'}}" 
                      style="height: {{item * 25}}%">
                  <view class="bar-fill"></view>
                  <text class="bar-value">{{item}}</text>
                </view>
              </view>
              <view class="chart-axis">
                <text class="axis-label">0</text>
                <text class="axis-label">5</text>
              </view>
            </view>
          </view>
          <view class="chart-item">
            <text class="chart-label">å¿ƒæƒ…è¯„åˆ†</text>
            <view class="chart-bars-container">
              <view class="chart-bars">
                <view wx:for="{{weeklyStats.moodScore}}" wx:key="*this" 
                      class="chart-bar {{item >= 4 ? 'high' : item >= 2 ? 'medium' : 'low'}}" 
                      style="height: {{item * 12}}%">
                  <view class="bar-fill"></view>
                  <text class="bar-value">{{item}}</text>
                </view>
              </view>
              <view class="chart-axis">
                <text class="axis-label">0</text>
                <text class="axis-label">5</text>
              </view>
            </view>
          </view>
        </view>
      </view>

      <!-- æœˆè¶‹åŠ¿ -->
      <view class="trend-card">
        <view class="trend-header">
          <text class="trend-title">æœˆåº¦è¶‹åŠ¿</text>
          <text class="trend-subtitle">æœ€è¿‘8å‘¨æ•°æ®</text>
        </view>
        <view class="monthly-trends">
          <view class="trend-line">
            <view class="line-header">
              <text class="line-label">ç–¼ç—›è¶‹åŠ¿</text>
              <view class="trend-indicator {{monthlyTrends.painTrend[7] > monthlyTrends.painTrend[0] ? 'up' : 'down'}}">
                <text class="indicator-text">{{monthlyTrends.painTrend[7] > monthlyTrends.painTrend[0] ? 'â†‘' : 'â†“'}}</text>
              </view>
            </view>
            <view class="line-chart-container">
              <view class="line-chart">
                <view class="chart-line"></view>
                <view wx:for="{{monthlyTrends.painTrend}}" wx:key="*this" 
                      class="line-point" style="left: {{index * 14.28}}%">
                  <view class="point-dot"></view>
                  <text class="point-value">{{item}}</text>
                </view>
              </view>
              <view class="chart-axis">
                <text class="axis-label">ç¬¬1å‘¨</text>
                <text class="axis-label">ç¬¬8å‘¨</text>
              </view>
            </view>
          </view>
          <view class="trend-line">
            <view class="line-header">
              <text class="line-label">ä½“é‡è¶‹åŠ¿</text>
              <view class="trend-indicator {{monthlyTrends.weightTrend[7] > monthlyTrends.weightTrend[0] ? 'up' : 'down'}}">
                <text class="indicator-text">{{monthlyTrends.weightTrend[7] > monthlyTrends.weightTrend[0] ? 'â†‘' : 'â†“'}}</text>
              </view>
            </view>
            <view class="line-chart-container">
              <view class="line-chart">
                <view class="chart-line"></view>
                <view wx:for="{{monthlyTrends.weightTrend}}" wx:key="*this" 
                      class="line-point" style="left: {{index * 14.28}}%">
                  <view class="point-dot"></view>
                  <text class="point-value">{{item}}</text>
                </view>
              </view>
              <view class="chart-axis">
                <text class="axis-label">ç¬¬1å‘¨</text>
                <text class="axis-label">ç¬¬8å‘¨</text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- åˆ†æé¡µé¢ -->
    <view wx:if="{{currentTab === 'analysis'}}" class="analysis-section">
      <!-- å¥åº·å»ºè®® -->
      <view class="recommendations-section">
        <view class="section-header">
          <text class="section-title">å¥åº·å»ºè®®</text>
        </view>
        <view class="recommendations-list">
          <view wx:for="{{recommendations}}" wx:key="title" class="recommendation-item {{item.type}}">
            <view class="recommendation-header">
              <text class="recommendation-title">{{item.title}}</text>
              <text class="recommendation-priority {{item.priority}}">{{item.priority}}</text>
            </view>
            <text class="recommendation-content">{{item.content}}</text>
          </view>
        </view>
      </view>

      <!-- é£é™©å› ç´  -->
      <view class="risks-section">
        <view class="section-header">
          <text class="section-title">é£é™©å› ç´ </text>
        </view>
        <view class="risks-list">
          <view wx:for="{{riskFactors}}" wx:key="factor" class="risk-item {{item.level}}">
            <view class="risk-header">
              <text class="risk-factor">{{item.factor}}</text>
              <text class="risk-level {{item.level}}">{{item.level}}</text>
            </view>
            <text class="risk-description">{{item.description}}</text>
          </view>
        </view>
      </view>

      <!-- æ”¹è¿›é¢†åŸŸ -->
      <view class="improvements-section">
        <view class="section-header">
          <text class="section-title">æ”¹è¿›é¢†åŸŸ</text>
        </view>
        <view class="improvements-list">
          <view wx:for="{{improvementAreas}}" wx:key="area" class="improvement-item">
            <view class="improvement-header">
              <text class="improvement-area">{{item.area}}</text>
              <text class="improvement-progress">{{item.progress}}%</text>
            </view>
            <view class="improvement-details">
              <text class="improvement-current">å½“å‰ï¼š{{item.current}}</text>
              <text class="improvement-target">ç›®æ ‡ï¼š{{item.target}}</text>
            </view>
            <view class="progress-bar">
              <view class="progress-fill" style="width: {{item.progress}}%"></view>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæŒ‰é’® -->
  <view class="bottom-actions">
    <button class="action-btn secondary" bindtap="exportReport">
      <text class="btn-text">å¯¼å‡ºæŠ¥å‘Š</text>
    </button>
    <button class="action-btn primary" bindtap="shareReport">
      <text class="btn-text">åˆ†äº«æŠ¥å‘Š</text>
    </button>
  </view>
</view> 
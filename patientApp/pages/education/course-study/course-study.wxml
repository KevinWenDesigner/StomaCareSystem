<!--patient-app/pages/education/course-study/course-study.wxml-->
<view class="container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <view class="header-left" bindtap="goBack">
      <text class="back-icon">â†</text>
    </view>
    <text class="page-title">{{course.title}}</text>
    <view class="header-right"></view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-state">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- è¯¾ç¨‹å­¦ä¹ å†…å®¹ -->
  <view wx:else class="study-content">
    <!-- å­¦ä¹ è¿›åº¦ -->
    <view class="progress-section">
      <view class="progress-header">
        <text class="progress-title">å­¦ä¹ è¿›åº¦</text>
        <text class="progress-percent">{{studyProgress}}%</text>
      </view>
      
      <view class="progress-bar">
        <view class="progress-fill" style="width: {{studyProgress}}%"></view>
      </view>
      
      <text class="progress-text">å·²å®Œæˆ {{studyProgress}}%</text>
    </view>

    <!-- å½“å‰ç« èŠ‚ -->
    <view wx:if="{{course.chapters && course.chapters[currentChapter]}}" class="chapter-section">
      <view class="chapter-header">
        <text class="chapter-title">ç¬¬{{currentChapter + 1}}ç« ï¼š{{course.chapters[currentChapter].title}}</text>
        <text class="chapter-duration">{{course.chapters[currentChapter].duration}}</text>
      </view>
      
      <view class="chapter-content">
        <view class="content-card">
          <text class="content-title">ç« èŠ‚å†…å®¹</text>
          
          <!-- çœŸå®çš„ç« èŠ‚å†…å®¹ï¼ˆHTMLå¯Œæ–‡æœ¬ï¼‰ -->
          <view wx:if="{{course.chapters[currentChapter].content}}" class="rich-content">
            <rich-text nodes="{{course.chapters[currentChapter].content}}"></rich-text>
          </view>
          
          <!-- å­¦ä¹ è¦ç‚¹ -->
          <view wx:if="{{course.chapters[currentChapter].learning_points}}" class="learning-points">
            <view class="points-header">
              <text class="points-title">ğŸ“š æœ¬ç« å­¦ä¹ è¦ç‚¹</text>
            </view>
            <view wx:for="{{course.chapters[currentChapter].learning_points}}" 
                  wx:key="*this" 
                  class="point-item">
              <text class="point-bullet">â€¢</text>
              <text class="point-text">{{item}}</text>
            </view>
          </view>
          
          <!-- ç« èŠ‚æ—¶é•¿æç¤º -->
          <view class="chapter-meta">
            <text class="meta-label">é¢„è®¡å­¦ä¹ æ—¶é—´ï¼š</text>
            <text class="meta-value">{{course.chapters[currentChapter].duration ? Math.ceil(course.chapters[currentChapter].duration / 60) : 5}}åˆ†é’Ÿ</text>
          </view>
        </view>
      </view>
    </view>

    <!-- ç« èŠ‚åˆ—è¡¨ -->
    <view wx:if="{{course.chapters}}" class="chapters-section">
      <view class="section-header">
        <text class="section-title">è¯¾ç¨‹ç« èŠ‚</text>
        <text class="section-subtitle">å…±{{course.chapters.length}}ä¸ªç« èŠ‚</text>
      </view>
      
      <view class="chapters-list">
        <view wx:for="{{course.chapters}}" wx:key="id" 
              class="chapter-item {{index === currentChapter ? 'active' : ''}} {{item.completed ? 'completed' : ''}}"
              bindtap="startChapter" data-index="{{index}}">
          <view class="chapter-info">
            <view class="chapter-header">
              <text class="chapter-number">ç¬¬{{item.id}}ç« </text>
              <text class="chapter-duration">{{item.duration}}</text>
            </view>
            <text class="chapter-title">{{item.title}}</text>
          </view>
          
          <view class="chapter-status">
            <text wx:if="{{item.completed}}" class="status-completed">å·²å®Œæˆ</text>
            <text wx:elif="{{index === currentChapter}}" class="status-current">å­¦ä¹ ä¸­</text>
            <text wx:else class="status-pending">å¾…å­¦ä¹ </text>
          </view>
        </view>
      </view>
    </view>

    <!-- è¯¾ç¨‹å®Œæˆæç¤º -->
    <view wx:if="{{isCompleted}}" class="completion-section">
      <view class="completion-card">
        <text class="completion-icon">ğŸ‰</text>
        <text class="completion-title">æ­å–œï¼</text>
        <text class="completion-text">æ‚¨å·²å®Œæˆæœ¬è¯¾ç¨‹çš„å­¦ä¹ </text>
        <text class="completion-desc">ç»§ç»­å­¦ä¹ å…¶ä»–è¯¾ç¨‹ï¼Œæå‡æŠ¤ç†æŠ€èƒ½</text>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæŒ‰é’® -->
  <view class="bottom-actions">
    <button wx:if="{{!isCompleted && course.chapters && course.chapters[currentChapter]}}" 
            class="action-btn primary" bindtap="completeChapter">
      <text class="btn-text">å®Œæˆå­¦ä¹ </text>
    </button>
    <button wx:else class="action-btn secondary" bindtap="goBack">
      <text class="btn-text">è¿”å›è¯¾ç¨‹</text>
    </button>
  </view>
</view> 
# 快速开始本地开发

## ⚡ 3分钟快速上手

适合：已经安装了 Node.js 和 MySQL 的开发者

---

## 步骤1️⃣：启动后端（2分钟）

### 配置数据库

```bash
# 打开 MySQL 命令行
mysql -u root -p

# 创建数据库
CREATE DATABASE stoma_care_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
EXIT;
```

### 配置环境变量

在 `backend` 目录创建 `.env` 文件：

```env
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=你的MySQL密码
DB_NAME=stoma_care_db
JWT_SECRET=dev_secret_123
WECHAT_APPID=wx61ba15d015833945
WECHAT_SECRET=39dcc9d80a1ccbc94142d96519efad07
PORT=3000
NODE_ENV=development
```

### 启动服务

```bash
cd backend

# 安装依赖（首次运行）
npm install

# 初始化数据库（首次运行）
npm run init-db

# 启动服务
npm run dev
```

**看到这个就成功了：**
```
✓ 数据库连接成功
✓ 服务器运行在端口 3000
```

---

## 步骤2️⃣：配置小程序（1分钟）

### 修改配置文件

**patientApp/config.js**（患者端）或 **nurseApp/config.js**（护士端）：

```javascript
module.exports = {
  apiBaseUrl: 'http://localhost:3000/api',  // 使用本地API
  uploadUrl: 'http://localhost:3000/api/assessments/upload',
  timeout: 10000,
  version: '1.0.0'
}
```

### 打开微信开发者工具

1. 导入项目：选择 `patientApp` 或 `nurseApp` 文件夹
2. AppID：填写 `wx61ba15d015833945` 或点击"使用测试号"
3. **重要**：点击右上角"详情" → "本地设置" → 勾选
   - ✅ **不校验合法域名、web-view（业务域名）、TLS版本以及HTTPS证书**

---

## 步骤3️⃣：开始调试！

### 测试登录

1. 在小程序中点击"一键登录"
2. 查看控制台输出
3. 查看后端终端日志

### 测试 API

```javascript
// 在小程序页面中
const app = getApp()

app.request({
  url: '/patients/profile',
  method: 'GET'
}).then(res => {
  console.log('获取成功:', res)
}).catch(err => {
  console.error('获取失败:', err)
})
```

---

## 🔍 快速调试

### 查看后端日志

后端运行的终端会显示：
```
GET /api/health 200 5ms
POST /api/auth/patient-login 200 150ms
GET /api/patients/profile 200 20ms
```

### 查看小程序日志

微信开发者工具 → **Console** 标签

### 查看网络请求

微信开发者工具 → **Network** 标签

### 查看存储数据

微信开发者工具 → **Storage** 标签

---

## ❓ 遇到问题？

### 问题1：小程序提示"不在合法域名列表"

**解决**：微信开发者工具 → 详情 → 本地设置 → 勾选"不校验合法域名"

### 问题2：登录失败

**检查**：
- 后端是否运行（访问 http://localhost:3000/api/health）
- `.env` 文件中的 AppID 和 AppSecret 是否正确

### 问题3：数据库连接失败

**检查**：
- MySQL 服务是否启动
- `.env` 中的数据库密码是否正确

### 问题4：端口被占用

```bash
# Windows - 查找占用 3000 端口的进程
netstat -ano | findstr :3000

# 杀死进程（PID 是上面查到的进程ID）
taskkill /PID <进程ID> /F
```

---

## 📋 常用命令

### 后端

```bash
cd backend

npm run dev          # 启动开发服务器（自动重启）
npm start           # 普通启动
npm run init-db     # 初始化数据库
```

### 测试 API

```bash
# 健康检查
curl http://localhost:3000/api/health

# 或在浏览器打开
http://localhost:3000/api/health
```

---

## 📚 详细文档

需要更详细的指南？查看：

- 📖 [本地开发联调指南.md](./本地开发联调指南.md) - 完整的调试指南
- 🔧 [backend/INSTALL.md](./backend/INSTALL.md) - 后端安装说明
- 📡 [backend/API.md](./backend/API.md) - API 文档

---

## 🎯 开发工作流

```bash
# 1. 每天开始工作
cd backend
npm run dev

# 2. 打开微信开发者工具
# 导入小程序项目

# 3. 开发代码
# 后端代码修改会自动重启
# 小程序点击"编译"查看效果

# 4. 查看日志调试
# 后端：终端窗口
# 小程序：开发者工具Console

# 5. 测试功能
# 在小程序中操作，观察日志

# 6. 提交代码
git add .
git commit -m "功能说明"
```

---

## 💡 调试技巧

### 小程序调试

```javascript
// 在页面中添加日志
console.log('当前页面:', getCurrentPages())
console.log('全局数据:', getApp().globalData)
console.log('本地存储:', wx.getStorageSync('token'))
```

### 后端调试

```javascript
// 在控制器或模型中添加日志
console.log('请求参数:', req.body)
console.log('用户信息:', req.user)
console.log('查询结果:', result)
```

### 使用断点

1. **小程序**：在代码行号处点击设置断点
2. **后端**：使用 VSCode 的调试功能（F5）

---

## 🎉 完成！

现在您可以：
- ✅ 在本地运行后端服务
- ✅ 小程序连接本地 API
- ✅ 实时查看日志和调试
- ✅ 快速迭代开发

**开始编码吧！** 🚀

---

## 快速参考卡片

### 后端地址
- API: `http://localhost:3000/api`
- 健康检查: `http://localhost:3000/api/health`

### 小程序配置
```javascript
apiBaseUrl: 'http://localhost:3000/api'
```

### 微信开发者工具
- ✅ 不校验合法域名
- ✅ 启用调试

### 查看日志
- 后端：终端窗口
- 小程序：Console 标签
- 网络：Network 标签
- 存储：Storage 标签

---

有问题？查看 [本地开发联调指南.md](./本地开发联调指南.md) 获取详细帮助！


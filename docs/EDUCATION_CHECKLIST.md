# 护理教育模块 - 实施检查清单

## 📋 实施前准备

### 环境检查
- [ ] Node.js 已安装 (v14+)
- [ ] MySQL 已安装并运行 (v5.7+)
- [ ] 微信开发者工具已安装
- [ ] Git 已安装（可选）

### 项目文件检查
- [ ] 后端代码已下载到 `backend/` 目录
- [ ] 前端代码已下载到 `patientApp/` 目录
- [ ] 所有依赖已安装 (`npm install`)

---

## 🗄️ 数据库配置

### 步骤1: 配置数据库连接
- [ ] 编辑 `backend/src/config/database.js`
- [ ] 确认MySQL连接信息正确
  - [ ] host (默认: localhost)
  - [ ] port (默认: 3306)
  - [ ] user (默认: root)
  - [ ] password (你的密码)
  - [ ] database (默认: stoma_care)

### 步骤2: 初始化数据库
- [ ] 打开终端，进入 `backend/` 目录
  ```bash
  cd backend
  ```
- [ ] 运行初始化脚本
  ```bash
  node src/scripts/initDatabase.js
  ```
- [ ] 确认输出显示"✅ 数据库初始化完成"

### 步骤3: 验证数据库
- [ ] 连接到MySQL数据库
  ```sql
  mysql -u root -p
  USE stoma_care;
  ```
- [ ] 检查课程分类表
  ```sql
  SELECT COUNT(*) FROM course_categories;
  -- 应该返回 5
  ```
- [ ] 检查课程表
  ```sql
  SELECT COUNT(*) FROM courses;
  -- 应该返回至少 5 条记录
  ```
- [ ] 检查学习记录表结构
  ```sql
  DESC learning_records;
  -- 应该显示表结构
  ```

---

## 🖥️ 后端服务器配置

### 步骤1: 安装依赖
- [ ] 在 `backend/` 目录下运行
  ```bash
  npm install
  ```
- [ ] 确认所有依赖安装成功，无错误

### 步骤2: 配置JWT密钥
- [ ] 编辑 `backend/src/config/jwt.js`
- [ ] 确认有JWT密钥配置
  ```javascript
  module.exports = {
    secret: '你的密钥',
    expiresIn: '7d'
  };
  ```

### 步骤3: 启动服务器
- [ ] 在 `backend/` 目录下运行
  ```bash
  npm run dev
  ```
- [ ] 确认服务器启动成功，输出类似：
  ```
  Server is running on port 3000
  ```

### 步骤4: 测试API健康检查
- [ ] 在浏览器或终端中访问
  ```
  http://localhost:3000/api/health
  ```
- [ ] 应该返回
  ```json
  {
    "success": true,
    "message": "服务运行正常",
    ...
  }
  ```

### 步骤5: 运行API测试脚本（可选）
- [ ] 在 `backend/` 目录下运行
  ```bash
  node src/scripts/testEducationAPI.js
  ```
- [ ] 查看测试结果，确认基础API正常

---

## 📱 前端小程序配置

### 步骤1: 配置API地址
- [ ] 编辑 `patientApp/config.js`
- [ ] 确认环境配置
  - **本地开发**: 
    ```javascript
    const ENV = 'development';
    apiBaseUrl: 'http://localhost:3000/api'
    ```
  - **真机调试**: 
    ```javascript
    const ENV = 'development';
    apiBaseUrl: 'http://你的电脑IP:3000/api'
    // 例如: http://192.168.1.100:3000/api
    ```

### 步骤2: 查找本机IP地址
- [ ] **Windows**: 运行命令 `ipconfig`，查找"IPv4地址"
- [ ] **Mac/Linux**: 运行命令 `ifconfig` 或 `ip addr`
- [ ] 记录下你的局域网IP（通常是 192.168.x.x）

### 步骤3: 配置微信开发者工具
- [ ] 打开微信开发者工具
- [ ] 导入项目，选择 `patientApp/` 目录
- [ ] 输入AppID（测试号也可以）
- [ ] 点击"详情"标签
  - [ ] 勾选"不校验合法域名、web-view（业务域名）、TLS版本以及HTTPS证书"
  - [ ] 勾选"启用调试"（可选）

### 步骤4: 配置网络访问
- [ ] **如果是真机调试**:
  - [ ] 确保手机和电脑在同一WiFi网络
  - [ ] 确保电脑防火墙允许3000端口访问
  - [ ] Windows防火墙设置：
    ```
    控制面板 → Windows Defender 防火墙 → 高级设置 → 入站规则 
    → 新建规则 → 端口 → TCP 3000 → 允许连接
    ```

---

## 🧪 功能测试

### 测试1: 用户登录
- [ ] 在小程序首页点击"微信快速登录"
- [ ] 确认登录成功，显示用户信息
- [ ] 在控制台验证Token
  ```javascript
  console.log(wx.getStorageSync('token'))
  // 应该输出一个JWT token字符串
  ```

### 测试2: 查看课程列表
- [ ] 点击底部导航栏"教育"标签
- [ ] 应该看到：
  - [ ] 4个课程分类卡片（基础知识、实践操作、饮食指导、应急处理）
  - [ ] 推荐课程列表（至少3门课程）
  - [ ] 学习统计数据区域

### 测试3: 查看课程详情
- [ ] 点击任意推荐课程卡片
- [ ] 应该进入课程详情页，显示：
  - [ ] 课程标题
  - [ ] 课程描述
  - [ ] 难度等级
  - [ ] 学习人数
  - [ ] 评分
  - [ ] "开始学习"按钮

### 测试4: 开始学习课程
- [ ] 在课程详情页点击"开始学习"
- [ ] 应该进入课程学习页面
- [ ] 查看小程序控制台，应该有日志：
  ```
  开始学习课程: {...}
  调用后端API创建初始学习记录
  初始学习记录创建成功
  ```

### 测试5: 记录学习进度
- [ ] 在学习页面完成章节学习
- [ ] 点击"完成章节"
- [ ] 查看控制台日志：
  ```
  调用后端API记录进度: ...
  学习进度已同步到后端
  ```
- [ ] 返回教育首页
- [ ] 确认"最近学习"区域显示该课程
- [ ] 确认学习统计数据已更新

### 测试6: 课程分类浏览
- [ ] 点击"基础知识"分类卡片
- [ ] 应该进入该分类的课程列表页
- [ ] 显示该分类下的所有课程

### 测试7: 点赞功能
- [ ] 在课程详情页点击"点赞"按钮
- [ ] 应该显示"点赞成功"提示
- [ ] 点赞数加1
- [ ] 查看控制台日志确认API调用成功

---

## 🔍 数据验证

### 数据库数据验证
- [ ] 连接MySQL数据库
- [ ] 查询学习记录
  ```sql
  SELECT lr.*, c.title, p.name 
  FROM learning_records lr
  JOIN courses c ON lr.course_id = c.id
  JOIN patients p ON lr.patient_id = p.id
  ORDER BY lr.last_study_at DESC
  LIMIT 10;
  ```
- [ ] 应该看到你的学习记录

### 后端日志验证
- [ ] 查看后端控制台输出
- [ ] 应该看到API请求日志
  ```
  GET /api/courses
  POST /api/courses/:id/progress
  GET /api/courses/my-learning
  ```

### 前端日志验证
- [ ] 查看小程序控制台
- [ ] 应该看到详细的调用日志
  ```
  护理教育页面加载
  获取课程列表响应: {...}
  解析的课程数据: [...]
  ```

---

## ✅ 完成确认

### 核心功能检查
- [ ] ✅ 课程分类正常显示
- [ ] ✅ 课程列表正常加载
- [ ] ✅ 课程详情正确显示
- [ ] ✅ 学习进度正常记录
- [ ] ✅ 学习统计数据正确
- [ ] ✅ 最近学习列表更新
- [ ] ✅ 课程点赞功能正常

### 数据流验证
- [ ] ✅ 前端→后端通信正常
- [ ] ✅ 后端→数据库读写正常
- [ ] ✅ 数据实时同步正常
- [ ] ✅ 本地缓存策略正常

### 用户体验检查
- [ ] ✅ 页面加载速度快
- [ ] ✅ 交互反馈及时
- [ ] ✅ 错误提示友好
- [ ] ✅ 数据显示准确

---

## 🐛 问题排查

### 如果课程列表为空
1. [ ] 检查数据库是否有课程数据
   ```sql
   SELECT COUNT(*) FROM courses;
   ```
2. [ ] 重新运行数据库初始化脚本
3. [ ] 查看后端日志是否有错误

### 如果API返回401
1. [ ] 检查用户是否已登录
2. [ ] 验证Token是否有效
   ```javascript
   console.log(wx.getStorageSync('token'))
   ```
3. [ ] 重新登录获取新Token

### 如果学习进度无法保存
1. [ ] 检查是否有患者ID
   ```javascript
   console.log(wx.getStorageSync('patientInfo'))
   ```
2. [ ] 查看后端日志中的错误信息
3. [ ] 确认数据库learning_records表结构正确

### 如果真机无法连接
1. [ ] 检查手机和电脑是否在同一WiFi
2. [ ] 验证IP地址配置正确
3. [ ] 检查防火墙是否允许3000端口
4. [ ] 在微信开发者工具中勾选"不校验合法域名"

---

## 📝 实施记录

### 实施信息
- **实施日期**: _______________
- **实施人员**: _______________
- **环境信息**:
  - Node.js版本: _______________
  - MySQL版本: _______________
  - 操作系统: _______________

### 遇到的问题及解决方案
1. 问题描述: _______________
   解决方案: _______________

2. 问题描述: _______________
   解决方案: _______________

### 备注
_______________________________________________
_______________________________________________
_______________________________________________

---

**检查清单版本**: 1.0.0  
**更新日期**: 2025-11-08

